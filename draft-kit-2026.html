<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>2026 NFL Draft Kit | PFF</title>
  <style>
    @import url('https://fonts.googleapis.com/css2?family=Archivo:wght@400;600;700&display=swap');

    :root {
      --primary: #FB6616;
      --accent: #FFC900;
      --warm-white: #ffffff;
      --steel-black: #0F0F10;
      --card-bg: #ffffff;
      --border: rgba(15, 15, 16, 0.12);
    }

    body {
      background-color: var(--warm-white);
      margin: 0;
      min-height: 100vh;
      display: flex;
      flex-direction: column;
      align-items: stretch;
    }

    /* WordPress embed: max 659px; self-contained, no horizontal scroll */
    #draft-kit-widget {
      font-family: 'Archivo', sans-serif;
      max-width: 659px;
      margin: 0 auto;
      padding: 16px;
      color: var(--steel-black);
      position: relative;
      box-sizing: border-box;
      width: 100%;
      overflow-x: hidden;
      flex: 0 0 auto;
      align-self: flex-start;
    }

    #draft-kit-widget * {
      box-sizing: border-box;
    }

    #tools-section {
      background: linear-gradient(135deg, var(--warm-white) 0%, var(--card-bg) 100%);
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 16px;
      box-shadow: 0 2px 6px rgba(15, 15, 16, 0.06);
      margin-bottom: 20px;
    }

    /* Dismissible discount banner above tools */
    #discount-banner {
      position: relative;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      padding: 14px 48px 14px 18px;
      margin-bottom: 14px;
      background: linear-gradient(135deg, var(--primary) 0%, #e55a0d 100%);
      border-radius: 12px;
      border: 3px solid rgba(255, 255, 255, 0.9);
      box-shadow: 0 4px 0 rgba(0, 0, 0, 0.15), 0 8px 24px rgba(251, 102, 22, 0.4);
      font-family: 'Archivo', sans-serif;
    }
    #discount-banner.is-dismissed {
      display: none;
    }
    #discount-banner .discount-banner-link {
      flex: 1;
      display: flex;
      align-items: center;
      justify-content: center;
      text-align: center;
      text-decoration: none;
      color: inherit;
      min-width: 0;
    }
    #discount-banner .discount-banner-link:hover {
      text-decoration: underline;
    }
    #discount-banner .discount-text {
      font-size: 18px;
      font-weight: 700;
      color: #ffffff;
      letter-spacing: 0.02em;
      text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3);
      animation: discount-text-pulse 2s ease-in-out infinite;
    }
    /* Alternate: yellow accent — change color to var(--accent) to try */
    @keyframes discount-text-pulse {
      0%, 100% {
        opacity: 1;
        text-shadow: 0 1px 3px rgba(0, 0, 0, 0.3), 0 0 0 transparent;
        transform: scale(1);
      }
      50% {
        opacity: 0.88;
        text-shadow: 0 2px 6px rgba(0, 0, 0, 0.35), 0 0 12px rgba(255, 255, 255, 0.4);
        transform: scale(1.02);
      }
    }
    #discount-banner .discount-dismiss {
      position: absolute;
      right: 12px;
      top: 50%;
      transform: translateY(-50%);
      flex-shrink: 0;
      width: 28px;
      height: 28px;
      padding: 0;
      border: none;
      background: rgba(255, 255, 255, 0.25);
      color: var(--card-bg);
      border-radius: 50%;
      font-size: 18px;
      line-height: 1;
      cursor: pointer;
      transition: background 0.2s ease;
    }
    #discount-banner .discount-dismiss:hover {
      background: rgba(255, 255, 255, 0.45);
    }
    @media (min-width: 480px) {
      #discount-banner .discount-text {
        font-size: 20px;
      }
    }

    #articles-section {
      margin-bottom: 20px;
    }

    #tools-section h2, #articles-section h2 {
      font-size: 20px;
      font-weight: 700;
      color: var(--steel-black);
      margin-bottom: 8px;
      border-bottom: 3px solid var(--primary);
      display: inline-block;
      padding-bottom: 4px;
    }

    .filters {
      display: flex;
      flex-direction: column;
      flex-wrap: wrap;
      gap: 10px;
      align-items: stretch;
      position: sticky;
      top: 0;
      backdrop-filter: blur(8px);
      background-color: rgba(251, 234, 224, 0.95);
      padding: 12px 0;
      z-index: 999;
      border-bottom: 1px solid var(--border);
    }

    .filters select, .filters input, .filters button {
      width: 100%;
      padding: 10px 14px;
      background-color: rgba(255, 255, 255, 0.9);
      border: 1px solid var(--border);
      border-radius: 10px;
      font-size: 14px;
      color: var(--steel-black);
      cursor: pointer;
      transition: all 0.2s ease;
      font-family: 'Archivo', sans-serif;
      min-height: 44px;
      box-sizing: border-box;
    }

    .filters select:focus, .filters input:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 2px rgba(251, 102, 22, 0.2);
    }

    .filters button:hover {
      background-color: var(--primary);
      color: var(--card-bg);
      border-color: var(--primary);
    }

    #search {
      width: 100%;
    }

    /* Trevor help banner */
    .trevor-banner-wrap {
      margin-bottom: 20px;
    }
    .countdown-banner {
      width: 100%;
      margin-top: 12px;
      padding: 14px 18px;
      text-align: center;
      background: linear-gradient(180deg, rgba(251, 102, 22, 0.08) 0%, rgba(251, 102, 22, 0.02) 100%);
      border-top: 3px solid var(--primary);
      border-radius: 0 0 10px 10px;
    }
    .countdown-banner .countdown-text {
      font-size: 15px;
      font-weight: 600;
      color: var(--steel-black);
      line-height: 1.5;
      letter-spacing: 0.02em;
    }
    .countdown-banner .countdown-num {
      font-weight: 800;
      color: var(--primary);
      font-size: 1.15em;
      letter-spacing: 0.04em;
      text-shadow: 0 1px 2px rgba(251, 102, 22, 0.25);
    }
    @media (min-width: 400px) {
      .countdown-banner {
        padding: 16px 20px;
      }
      .countdown-banner .countdown-text {
        font-size: 17px;
      }
      .countdown-banner .countdown-num {
        font-size: 1.25em;
      }
    }
    .feed-freshness {
      font-size: 12px;
      color: var(--steel-black);
      opacity: 0.7;
      margin-top: 12px;
      margin-bottom: 0;
    }
    #trevor-help-banner {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 12px;
      width: 100%;
      padding: 14px 20px;
      margin-bottom: 0;
      background: linear-gradient(135deg, var(--primary) 0%, #e55a0d 100%);
      border-radius: 12px;
      border: 1px solid rgba(251, 102, 22, 0.4);
      cursor: pointer;
      transition: transform 0.2s ease, box-shadow 0.2s ease;
      font-family: 'Archivo', sans-serif;
    }
    #trevor-help-banner:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(251, 102, 22, 0.35);
    }
    #trevor-help-banner .trevor-avatar {
      width: 44px;
      height: 44px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid rgba(255, 255, 255, 0.6);
    }
    #trevor-help-banner .help-text {
      font-size: 16px;
      font-weight: 700;
      color: var(--card-bg);
      letter-spacing: 0.02em;
    }
    @media (min-width: 400px) {
      #trevor-help-banner .help-text {
        font-size: 18px;
      }
    }

    /* Trevor chatbot modal – chat-style, anchored to top of viewport */
    #trevor-modal-overlay {
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(15, 15, 16, 0.6);
      backdrop-filter: blur(4px);
      z-index: 10000;
      display: none;
      align-items: flex-start;
      justify-content: center;
      padding: 20px 20px 24px;
      box-sizing: border-box;
      overflow-y: auto;
    }
    #trevor-modal-overlay.is-open {
      display: flex;
    }
    #trevor-modal {
      background: var(--card-bg);
      border-radius: 16px;
      max-width: 560px;
      width: 100%;
      min-height: 480px;
      height: 780px;
      max-height: 90vh;
      overflow: hidden;
      box-shadow: 0 20px 50px rgba(0, 0, 0, 0.25);
      border: 1px solid var(--border);
      font-family: 'Archivo', sans-serif;
      display: flex;
      flex-direction: column;
      flex-shrink: 0;
    }
    #trevor-modal .chat-header {
      display: flex;
      align-items: center;
      gap: 12px;
      padding: 14px 16px;
      border-bottom: 1px solid var(--border);
      background: var(--warm-white);
      flex-shrink: 0;
    }
    #trevor-modal .chat-header .trevor-avatar {
      width: 42px;
      height: 42px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid var(--primary);
    }
    #trevor-modal .chat-header .chat-title {
      font-size: 17px;
      font-weight: 700;
      color: var(--steel-black);
      margin: 0;
    }
    #trevor-modal .chat-messages {
      flex: 1 1 0;
      min-height: 0;
      overflow-y: auto;
      overflow-x: hidden;
      padding: 16px;
      display: flex;
      flex-direction: column;
      gap: 12px;
      -webkit-overflow-scrolling: touch;
    }
    #trevor-modal .msg {
      display: flex;
      align-items: flex-end;
      gap: 10px;
      max-width: 92%;
    }
    #trevor-modal .msg.msg-bot {
      align-self: flex-start;
    }
    #trevor-modal .msg.msg-user {
      align-self: flex-end;
      flex-direction: row-reverse;
    }
    #trevor-modal .msg-avatar {
      width: 32px;
      height: 32px;
      border-radius: 50%;
      object-fit: cover;
      flex-shrink: 0;
      border: 1px solid var(--border);
    }
    #trevor-modal .msg-user .msg-avatar {
      display: none;
    }
    #trevor-modal .msg-bubble {
      padding: 11px 14px;
      border-radius: 16px;
      font-size: 14px;
      line-height: 1.4;
      font-weight: 500;
      word-wrap: break-word;
    }
    #trevor-modal .msg-bot .msg-bubble {
      background: var(--warm-white);
      border: 1px solid var(--border);
      color: var(--steel-black);
      border-bottom-left-radius: 4px;
    }
    /* Typing indicator – three bouncing dots */
    #trevor-modal .typing-dots {
      display: flex;
      align-items: center;
      gap: 4px;
      padding: 4px 0;
    }
    #trevor-modal .typing-dots span {
      width: 6px;
      height: 6px;
      border-radius: 50%;
      background: var(--steel-black);
      opacity: 0.5;
      animation: typingBounce 1.4s ease-in-out infinite both;
    }
    #trevor-modal .typing-dots span:nth-child(1) { animation-delay: 0s; }
    #trevor-modal .typing-dots span:nth-child(2) { animation-delay: 0.2s; }
    #trevor-modal .typing-dots span:nth-child(3) { animation-delay: 0.4s; }
    @keyframes typingBounce {
      0%, 60%, 100% { transform: translateY(0); opacity: 0.5; }
      30% { transform: translateY(-5px); opacity: 1; }
    }
    #trevor-modal .msg-user .msg-bubble {
      background: var(--primary);
      color: var(--card-bg);
      border-bottom-right-radius: 4px;
    }
    /* Sleek action buttons inside bot bubbles */
    #trevor-modal .trevor-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      margin-top: 14px;
      padding-top: 12px;
      border-top: 1px solid var(--border);
    }
    #trevor-modal .trevor-btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      padding: 10px 18px;
      font-size: 13px;
      font-weight: 600;
      font-family: 'Archivo', sans-serif;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s ease;
      text-decoration: none;
      border: none;
      letter-spacing: 0.02em;
    }
    #trevor-modal .trevor-btn-copy {
      background: var(--steel-black);
      color: var(--card-bg);
    }
    #trevor-modal .trevor-btn-copy:hover {
      background: #2a2a2c;
      transform: translateY(-1px);
    }
    #trevor-modal .trevor-btn-copy.copied {
      background: #0d7d4d;
      color: var(--card-bg);
    }
    #trevor-modal .trevor-btn-link {
      background: transparent;
      color: var(--primary);
      border: 1.5px solid var(--primary);
    }
    #trevor-modal .trevor-btn-link:hover {
      background: rgba(251, 102, 22, 0.08);
      transform: translateY(-1px);
    }
    /* Inline clickable options inside bot bubble */
    #trevor-modal .trevor-inline-options {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px solid var(--border);
    }
    #trevor-modal .trevor-option-btn {
      display: inline-block;
      padding: 8px 14px;
      font-size: 12px;
      font-weight: 600;
      font-family: 'Archivo', sans-serif;
      color: var(--steel-black);
      background: var(--warm-white);
      border: 1px solid var(--border);
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.2s ease;
      text-align: center;
      letter-spacing: 0.01em;
    }
    #trevor-modal .trevor-option-btn:hover {
      background: rgba(251, 102, 22, 0.1);
      border-color: var(--primary);
      color: var(--primary);
    }
    #trevor-modal .trevor-option-back {
      color: var(--primary);
      border-color: transparent;
      background: transparent;
      font-size: 11px;
    }
    #trevor-modal .trevor-option-back:hover {
      text-decoration: underline;
    }
    /* Article links list inside bot bubble */
    #trevor-modal .trevor-article-links {
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      gap: 6px;
      max-height: 200px;
      overflow-y: auto;
    }
    #trevor-modal .trevor-article-link {
      display: block;
      font-size: 12px;
      font-weight: 600;
      color: var(--primary);
      text-decoration: none;
      padding: 6px 0;
      border-bottom: 1px solid transparent;
      transition: color 0.2s ease, border-color 0.2s ease;
      font-family: 'Archivo', sans-serif;
      text-align: left;
      line-height: 1.3;
    }
    #trevor-modal .trevor-article-link:hover {
      color: #e55a0d;
      border-bottom-color: var(--primary);
    }
    #trevor-modal .trevor-cta-pff a {
      color: var(--primary);
      text-decoration: none;
      transition: color 0.2s ease;
    }
    #trevor-modal .trevor-cta-pff a:hover {
      color: #e55a0d;
    }
    /* Draft tools list in bot bubble */
    #trevor-modal .trevor-tool-list {
      margin-top: 12px;
      padding-top: 12px;
      border-top: 1px solid var(--border);
      display: flex;
      flex-direction: column;
      gap: 12px;
    }
    #trevor-modal .trevor-tool-item {
      text-align: left;
    }
    #trevor-modal .trevor-tool-link {
      display: block;
      text-decoration: none;
      color: inherit;
      border-radius: 8px;
      padding: 8px 0;
      border-bottom: 1px solid transparent;
      transition: background 0.2s ease, border-color 0.2s ease, color 0.2s ease;
    }
    #trevor-modal .trevor-tool-link:hover {
      background: rgba(251, 102, 22, 0.08);
      border-bottom-color: var(--primary);
    }
    #trevor-modal .trevor-tool-link:hover .trevor-tool-title {
      color: var(--primary);
    }
    #trevor-modal .trevor-tool-title {
      font-size: 13px;
      font-weight: 700;
      color: var(--steel-black);
      margin-bottom: 4px;
      line-height: 1.3;
      transition: color 0.2s ease;
    }
    #trevor-modal .trevor-tool-desc {
      font-size: 12px;
      font-weight: 500;
      color: var(--steel-black);
      opacity: 0.85;
      line-height: 1.4;
    }
    #trevor-modal .chat-chips {
      padding: 0 16px 8px;
      flex: 0 1 auto;
      max-height: 42vh;
      min-height: 0;
      overflow-y: auto;
      overflow-x: hidden;
      display: flex;
      flex-direction: column;
      gap: 8px;
      -webkit-overflow-scrolling: touch;
    }
    #trevor-modal .chat-a11y-hint {
      padding: 0 16px 16px;
      margin: 0;
      font-size: 11px;
      color: var(--steel-black);
      opacity: 0.6;
    }
    #trevor-modal .chat-chip {
      display: block;
      width: 100%;
      padding: 12px 16px;
      font-size: 13px;
      font-weight: 600;
      color: var(--steel-black);
      background: var(--warm-white);
      border: 1px solid var(--border);
      border-radius: 10px;
      cursor: pointer;
      transition: background 0.2s ease, border-color 0.2s ease, color 0.2s ease;
      font-family: 'Archivo', sans-serif;
      text-align: left;
    }
    #trevor-modal .chat-chip:hover,
    #trevor-modal .chat-chip:focus-visible {
      background: rgba(251, 102, 22, 0.12);
      border-color: var(--primary);
      color: var(--primary);
      outline: 2px solid var(--primary);
      outline-offset: 2px;
    }
    #trevor-modal .chat-chip.chip-surprise {
      background: linear-gradient(135deg, var(--accent) 0%, #e6b800 100%);
      border-color: rgba(255, 200, 0, 0.5);
      color: var(--steel-black);
      transition: background 0.2s ease, border-color 0.2s ease, color 0.2s ease, transform 0.2s ease, box-shadow 0.2s ease;
    }
    #trevor-modal .chat-chip.chip-surprise:hover,
    #trevor-modal .chat-chip.chip-surprise:focus,
    #trevor-modal .chat-chip.chip-surprise:focus-visible {
      background: rgba(251, 102, 22, 0.2);
      border-color: var(--primary);
      border-width: 2px;
      color: var(--primary);
      transform: translateY(-2px);
      box-shadow: 0 4px 14px rgba(251, 102, 22, 0.35);
      outline: 2px solid var(--primary);
      outline-offset: 2px;
    }
    #trevor-modal .chat-chip.chip-surprise:active {
      transform: translateY(0);
    }
    #trevor-modal .chat-chip.chip-back {
      font-size: 12px;
      color: var(--primary);
      border-color: transparent;
      background: transparent;
    }
    #trevor-modal .chat-chip.chip-back:hover {
      text-decoration: underline;
    }
    #trevor-modal .modal-close {
      position: absolute;
      top: 12px;
      right: 12px;
      width: 32px;
      height: 32px;
      border: none;
      background: rgba(15, 15, 16, 0.08);
      border-radius: 50%;
      cursor: pointer;
      font-size: 18px;
      line-height: 1;
      color: var(--steel-black);
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 2;
    }
    #trevor-modal .modal-close:hover {
      background: rgba(15, 15, 16, 0.14);
    }
    #trevor-modal .modal-wrapper {
      position: relative;
      height: 100%;
      display: flex;
      flex-direction: column;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 14px;
      margin-top: 16px;
    }

    .card {
      border: 1px solid var(--border);
      border-radius: 12px;
      padding: 14px;
      background: linear-gradient(145deg, var(--card-bg), var(--warm-white));
      box-shadow: 0 2px 6px rgba(15, 15, 16, 0.06);
      transform: translateY(20px) scale(0.95);
      opacity: 0;
      transition: transform 0.5s ease, opacity 0.5s ease, box-shadow 0.2s ease;
      position: relative;
      overflow: hidden;
      cursor: pointer;
      min-width: 0;
    }

    .card.visible {
      transform: translateY(0) scale(1);
      opacity: 1;
    }

    .card:hover {
      transform: translateY(-4px) scale(1.02);
      box-shadow: 0 12px 24px rgba(251, 102, 22, 0.15);
      border-color: rgba(251, 102, 22, 0.3);
    }

    .card.is-new {
      border: 2px solid var(--primary);
    }

    .card.is-new:hover {
      border-color: var(--primary);
    }

    .card-overlay {
      position: absolute;
      inset: 0;
      background: rgba(251, 102, 22, 0.04);
      display: flex;
      align-items: center;
      justify-content: center;
      opacity: 0;
      transition: opacity 0.4s ease;
      overflow: hidden;
      pointer-events: none;
    }

    .card:hover .card-overlay {
      opacity: 1;
    }

    .overlay-icon {
      width: 28px;
      height: auto;
      max-width: 50%;
      max-height: 50%;
      object-fit: contain;
      opacity: 0.12;
      transition: width 0.35s ease, max-width 0.35s ease, opacity 0.35s ease;
    }

    .card:hover .overlay-icon {
      width: 100px;
      max-width: 58%;
      max-height: 58%;
      opacity: 0.16;
    }

    .icon-button {
      background: none;
      border: none;
      padding: 0;
      cursor: pointer;
      position: relative;
      width: 32px;
      height: 32px;
      min-width: 32px;
      min-height: 32px;
      display: flex;
      align-items: center;
      justify-content: center;
      touch-action: manipulation;
    }

    .icon-button img {
      width: 18px;
      height: 18px;
      display: block;
      transition: transform 0.2s ease;
      pointer-events: none;
      z-index: 2;
      position: relative;
    }

    .icon-button:hover img {
      transform: scale(1.2);
    }

    .card div[style*="position:absolute"] {
      display: block;
      width: auto;
    }

    .bookmark-button.active::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      margin: auto;
      width: 100%;
      height: 100%;
      background: var(--accent);
      border-radius: 50%;
      opacity: 1;
      z-index: 1;
      transition: opacity 0.3s ease, transform 0.3s ease;
    }

    .bookmark-button.active:hover::before {
      transform: scale(1.2);
      opacity: 0.4;
    }

    .badge {
      position: absolute;
      top: 0;
      left: 0;
      background: var(--primary);
      color: var(--card-bg);
      padding: 5px 10px;
      border-radius: 0 0 10px 0;
      font-size: 10px;
      font-weight: 700;
      text-transform: uppercase;
      z-index: 2;
      line-height: 1.2;
    }

    .card-title {
      font-size: 16px;
      font-weight: 700;
      color: var(--steel-black);
      margin-top: 22px;
      margin-bottom: 5px;
      text-decoration: none;
      transition: color 0.3s ease;
      display: block;
      line-height: 1.35;
      word-wrap: break-word;
      overflow-wrap: break-word;
    }

    .card:hover .card-title {
      color: var(--primary);
    }

    .card.tool {
      text-align: center;
      border: 2px solid var(--primary);
    }

    .card.tool:hover {
      border-color: var(--primary);
    }

    .card.tool .card-title {
      font-size: 18px;
      font-weight: 800;
      margin-top: 28px;
      letter-spacing: 0.02em;
    }

    .card.tool:hover .card-title {
      color: var(--primary);
    }

    .card-author {
      font-size: 14px;
      color: var(--steel-black);
      opacity: 0.75;
      margin-bottom: 6px;
    }

    .card-date {
      font-size: 12px;
      color: var(--steel-black);
      opacity: 0.6;
      margin-bottom: 10px;
    }

    .ripple {
      position: absolute;
      border-radius: 50%;
      background: rgba(251, 102, 22, 0.3);
      transform: scale(0);
      animation: ripple 0.6s ease-out;
      pointer-events: none;
    }
    @keyframes ripple {
      to { transform: scale(4); opacity: 0; }
    }

    /* Confetti burst when copying discount code */
    .confetti-burst {
      position: fixed;
      inset: 0;
      pointer-events: none;
      z-index: 10001;
      overflow: hidden;
    }
    .confetti-burst .confetti-piece {
      position: absolute;
      left: 50%;
      top: 50%;
      width: 8px;
      height: 8px;
      margin-left: -4px;
      margin-top: -4px;
      border-radius: 1px;
      opacity: 1;
      animation: confetti-fly 1.6s ease-out forwards;
    }
    @keyframes confetti-fly {
      to {
        transform: translate(var(--dx), var(--dy)) rotate(var(--rot));
        opacity: 0;
      }
    }

    .dk-loading {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: flex-start;
      min-height: 0;
      padding: 0 24px 24px 24px;
      text-align: center;
    }
    /* Keep loading at very top when in iframe */
    #draft-kit-widget:has(#draft-kit-loading) {
      padding-top: 0;
    }
    #draft-kit-widget:has(#draft-kit-loading) .dk-loading {
      padding-top: 0;
    }

    .dk-logo-loading {
      width: 160px;
      max-width: 100%;
      height: auto;
      object-fit: contain;
      display: block;
    }

    .dk-logo-loading.is-animating {
      animation: dkPulse 1.6s ease-in-out infinite;
    }

    @keyframes dkPulse {
      0% { opacity: 0.25; transform: scale(0.98); }
      50% { opacity: 1; transform: scale(1); }
      100% { opacity: 0.25; transform: scale(0.98); }
    }

    .dk-loading-text {
      margin-top: 16px;
      font-size: 14px;
      font-weight: 600;
      color: var(--steel-black);
      opacity: 0.85;
    }

    #draft-kit-content {
      display: none;
    }

    #draft-kit-content.is-visible {
      display: block;
    }

    /* Mobile: tighter layout, touch-friendly */
    @media (max-width: 480px) {
      #draft-kit-widget {
        padding: 12px;
      }

      #tools-section {
        padding: 12px;
      }

      #tools-section h2, #articles-section h2 {
        font-size: 18px;
      }

      .filters {
        padding: 10px 0;
        gap: 8px;
      }

      .filters select, .filters input, .filters button {
        min-height: 48px;
      }

      .grid {
        grid-template-columns: repeat(2, 1fr);
        gap: 12px;
        margin-top: 12px;
      }

      .card {
        padding: 12px;
      }

      .card-title {
        font-size: 15px;
      }

      .card-author {
        font-size: 13px;
      }

      .card-date {
        font-size: 11px;
      }

      .pill {
        font-size: 10px;
        padding: 3px 8px;
      }

      .icon-button {
        width: 36px;
        height: 36px;
        min-width: 36px;
        min-height: 36px;
      }

      .icon-button img {
        width: 18px;
        height: 18px;
      }

      .dk-loading {
        padding: 16px 16px 0 16px;
      }

      .dk-logo-loading {
        width: 140px;
      }

      .dk-loading-text {
        font-size: 13px;
        margin-top: 12px;
      }
    }
  </style>
</head>
<body>
  <div id="draft-kit-widget">
    <div id="draft-kit-loading" class="dk-loading">
      <img
        class="dk-logo-loading is-animating"
        src="https://media.pff.com/2025/09/PFF_PoweredBy_Black.png"
        alt="Powered by PFF"
      />
      <p class="dk-loading-text">Loading data…</p>
    </div>
    <div id="draft-kit-content"></div>
  </div>

  <script>
    const CSV_URL = 'https://docs.google.com/spreadsheets/d/e/2PACX-1vRrz50SRrQmYwJKAXBIs2788CYrBJr3YhXQjbUOGW4MWmh-Ymd0y77gBui8XhaKdStMelAIK-ntX0II/pub?output=csv';

    const FETCH_TIMEOUT_MS = 8000;

    function getCsvUrls() {
      const urls = [];
      if (window.location.origin && window.location.origin !== 'null' && window.location.protocol !== 'file:') {
        urls.push(window.location.origin + '/api/sheet');
      }
      urls.push(CSV_URL);
      return urls;
    }

    function fetchTextWithTimeout(url, timeoutMs) {
      const controller = new AbortController();
      const timer = setTimeout(function() { controller.abort(); }, timeoutMs);
      return fetch(url, { mode: 'cors', cache: 'no-cache', signal: controller.signal })
        .then(function(r) {
          clearTimeout(timer);
          if (!r.ok) throw new Error('Fetch failed (' + r.status + ')');
          return r.text();
        })
        .catch(function(err) {
          clearTimeout(timer);
          throw err;
        });
    }

    function fetchWithProxy(url) {
      return fetchTextWithTimeout(url, FETCH_TIMEOUT_MS).catch(function() {
        var proxyUrls = [
          'https://api.allorigins.win/raw?url=' + encodeURIComponent(url),
          'https://corsproxy.io/?' + encodeURIComponent(url),
          'https://api.codetabs.com/v1/proxy?quest=' + encodeURIComponent(url)
        ];
        var i = 0;
        function tryNext() {
          if (i >= proxyUrls.length) return Promise.reject(new Error('All proxies failed'));
          return fetchTextWithTimeout(proxyUrls[i++], FETCH_TIMEOUT_MS).catch(tryNext);
        }
        return tryNext();
      });
    }

    function parseCSV(text) {
      const rows = [];
      let row = [];
      let cell = '';
      let inQuotes = false;
      for (let i = 0; i < text.length; i++) {
        const ch = text[i];
        if (ch === '"') {
          inQuotes = !inQuotes;
        } else if (inQuotes) {
          cell += ch;
        } else if (ch === ',' || ch === '\n') {
          row.push(cell.trim());
          cell = '';
          if (ch === '\n') {
            if (row.some(c => c)) rows.push(row);
            row = [];
          }
        } else {
          cell += ch;
        }
      }
      if (cell || row.length) {
        row.push(cell.trim());
        if (row.some(c => c)) rows.push(row);
      }
      return rows;
    }

    function parseDate(val) {
      if (!val) return new Date(0);
      const str = String(val).trim();
      const parts = str.split(/[\s,@]+/);
      const datePart = parts[0] || '';
      const [d, m, y] = datePart.split(/[/-]/).map(Number);
      if (y && m && d) {
        const month = m - 1;
        const date = new Date(y, month, d);
        if (!isNaN(date.getTime())) return date;
      }
      const fallback = new Date(str);
      return isNaN(fallback.getTime()) ? new Date(0) : fallback;
    }

    function loadDraftKit() {
      var loadingEl = document.getElementById('draft-kit-loading');
      var contentEl = document.getElementById('draft-kit-content');

      function processCSV(text) {
        var lower = (text || '').toLowerCase();
        if (lower.indexOf('signin') !== -1 || lower.indexOf('<html') !== -1) {
          throw new Error('Sheet may be private or blocked');
        }
        var rows = parseCSV(text.replace(/\r/g, ''));
        if (rows.length < 2) {
          throw new Error('No data in sheet yet');
        }
        var headers = rows[0].map(function(h) { return h.trim().toLowerCase(); });
        var articles = [];
        for (var i = 1; i < rows.length; i++) {
          var row = rows[i];
          var get = function(name) {
            var idx = headers.indexOf(name);
            return idx >= 0 && row[idx] !== undefined ? row[idx] : '';
          };
          var headline = get('article title') || row[0] || '';
          var category = get('category') || row[1] || '';
          var positionalFocus = get('positional focus') || row[2] || '';
          var nflTeam = get('nfl team') || row[3] || '';
          var locked = (get('locked?') || row[4] || 'N').trim().toUpperCase();
          var dateVal = get('date @ time published') || row[5] || '';
          var author = get('author') || row[6] || '';
          var url = get('link') || row[7] || '';
          if (!headline && !url) continue;
          articles.push({
            headline: headline,
            category: category,
            positionalFocus: positionalFocus,
            nflTeam: nflTeam,
            premium: locked === 'Y' ? 'Subscriber Only' : 'Free',
            locked: locked === 'Y',
            publishDate: parseDate(dateVal),
            author: author,
            url: url
          });
        }
        articles.sort(function(a, b) { return b.publishDate - a.publishDate; });
        if (loadingEl) loadingEl.style.display = 'none';
        if (contentEl) {
          contentEl.classList.add('is-visible');
          contentEl.dataset.loadedAt = String(Date.now());
        }
        renderDraftKit(articles, contentEl);
      }

      function showError(msg) {
        if (loadingEl) loadingEl.style.display = 'none';
        if (contentEl) {
          contentEl.classList.add('is-visible');
          contentEl.innerHTML = '<p style="color:var(--primary); text-align:center; padding:24px;">' + escapeHtml(msg) + '</p>';
        }
      }

      var urls = getCsvUrls();
      var index = 0;
      function tryNext() {
        if (index >= urls.length) {
          showError('Unable to load data. Try running python3 server.py in this folder and opening http://localhost:8765/draft-kit-2026.html');
          return;
        }
        fetchWithProxy(urls[index++]).then(processCSV).catch(tryNext);
      }
      tryNext();
    }

    function escapeAttr(str) {
      if (str == null) return '';
      return String(str)
        .replace(/&/g, '&amp;')
        .replace(/"/g, '&quot;')
        .replace(/'/g, '&#39;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;');
    }

    function playCopyConfetti(root) {
      root = root || document.body;
      var colors = ['#FB6616', '#FFC900', '#FBEAE0', '#ffffff', '#e55a0d'];
      var container = document.createElement('div');
      container.className = 'confetti-burst';
      var count = 55;
      for (var i = 0; i < count; i++) {
        var angle = (Math.PI * 2 * i) / count + Math.random() * 0.5;
        var dist = 80 + Math.random() * 180;
        var dx = Math.cos(angle) * dist;
        var dy = Math.sin(angle) * dist - 40;
        var piece = document.createElement('div');
        piece.className = 'confetti-piece';
        piece.style.setProperty('--dx', dx + 'px');
        piece.style.setProperty('--dy', dy + 'px');
        piece.style.setProperty('--rot', (360 + Math.random() * 360) + 'deg');
        piece.style.background = colors[Math.floor(Math.random() * colors.length)];
        container.appendChild(piece);
      }
      root.appendChild(container);
      setTimeout(function() {
        if (container.parentNode) container.parentNode.removeChild(container);
      }, 1800);
    }

    function escapeHtml(str) {
      if (str == null) return '';
      return String(str)
        .replace(/&/g, '&amp;')
        .replace(/</g, '&lt;')
        .replace(/>/g, '&gt;')
        .replace(/"/g, '&quot;');
    }

    function renderDraftKit(articles, container) {
      var widget = container || document.getElementById('draft-kit-content');
      if (!widget) return;

      const tools = articles.filter(a => String(a.category).trim().toLowerCase() === 'tools');
      const regularArticles = articles.filter(a => String(a.category).trim().toLowerCase() !== 'tools');

      const TREVOR_IMG = 'https://media.pff.com/2025/11/Trevor-Sikkeman-min.png';

      function isPublishedToday(publishDate) {
        var d = new Date(publishDate);
        var now = new Date();
        return d.getFullYear() === now.getFullYear() && d.getMonth() === now.getMonth() && d.getDate() === now.getDate();
      }

      widget.innerHTML = `
        <div id="tools-section">
          <div id="discount-banner" class="">
            <a href="https://subscribe.pff.com/?promoCode=draftkit25" target="_blank" rel="noopener noreferrer" class="discount-banner-link">
              <span class="discount-text">Use DRAFTKIT25 for 25% off</span>
            </a>
            <button type="button" class="discount-dismiss" aria-label="Dismiss">×</button>
          </div>
          <h2>Interactive Tools</h2>
          <div class="grid" id="tools-grid"></div>
        </div>
        <div class="trevor-banner-wrap">
          <div id="trevor-help-banner" role="button" tabindex="0" aria-label="Chat with Trevor to find content">
            <img class="trevor-avatar" src="${TREVOR_IMG}" alt="Trevor">
            <span class="help-text">What can I help you find today?</span>
          </div>
          <div class="countdown-banner" id="countdown-banner" role="status" aria-live="polite">
            <span class="countdown-text" id="draft-countdown-text"></span>
          </div>
        </div>
        <div id="articles-section">
          <h2>Latest Articles & Analysis</h2>
          <div class="filters"></div>
          <div class="grid" id="article-grid"></div>
          <p id="feed-freshness" class="feed-freshness"></p>
        </div>
        <div id="trevor-modal-overlay" aria-hidden="true">
          <div id="trevor-modal" role="dialog" aria-label="Chat with Trevor" aria-modal="true">
            <div class="modal-wrapper">
              <button class="modal-close" type="button" aria-label="Close">&times;</button>
              <div class="chat-header">
                <img class="trevor-avatar" src="${TREVOR_IMG}" alt="Trevor">
                <h2 class="chat-title">Trevor</h2>
              </div>
              <div class="chat-messages" id="trevor-chat-messages"></div>
              <div class="chat-chips" id="trevor-chips"></div>
              <p class="chat-a11y-hint" id="trevor-enter-hint" aria-live="polite">Press Enter to choose</p>
            </div>
          </div>
        </div>
      `;

      renderFilters();
      renderToolsGrid(tools);
      renderArticlesGrid(regularArticles);
      applyBookmarkStates();
      initTrevorChatbot();

      (function initDiscountBanner() {
        var banner = widget.querySelector('#discount-banner');
        var dismissBtn = widget.querySelector('.discount-dismiss');
        if (!banner || !dismissBtn) return;
        dismissBtn.addEventListener('click', function() {
          banner.classList.add('is-dismissed');
        });
      })();

      (function initFreshness() {
        var loadedAt = parseInt(widget.dataset.loadedAt || '0', 10) || Date.now();
        function timeAgo(ts) {
          var d = Date.now() - ts;
          if (d < 60000) return 'just now';
          if (d < 3600000) return Math.floor(d / 60000) + ' min ago';
          if (d < 86400000) return Math.floor(d / 3600000) + ' hours ago';
          return Math.floor(d / 86400000) + ' days ago';
        }
        var freshEl = widget.querySelector('#feed-freshness');
        if (freshEl) {
          function updateFreshness() { freshEl.textContent = 'Updated ' + timeAgo(loadedAt); }
          updateFreshness();
          setInterval(updateFreshness, 60000);
        }
      })();

      (function initDraftCountdown() {
        var draftDate = new Date('2026-04-23T20:00:00-04:00');
        var el = widget.querySelector('#draft-countdown-text');
        if (!el) return;
        function pad(n) { return n < 10 ? '0' + n : String(n); }
        function update() {
          var diff = draftDate - new Date();
          if (diff <= 0) {
            el.innerHTML = 'Draft day — April 23, 2026';
            return;
          }
          var totalSec = Math.floor(diff / 1000);
          var ss = totalSec % 60;
          var totalMin = Math.floor(totalSec / 60);
          var mm = totalMin % 60;
          var totalHr = Math.floor(totalMin / 60);
          var hh = totalHr % 24;
          var dd = Math.floor(totalHr / 24);
          el.innerHTML = 'The 2026 NFL Draft will start in <span class="countdown-num">' + dd + '</span> days, <span class="countdown-num">' + pad(mm) + '</span> minutes and <span class="countdown-num">' + pad(ss) + '</span> seconds';
        }
        update();
        setInterval(update, 1000);
      })();

      function renderToolsGrid(tools) {
        const grid = widget.querySelector('#tools-grid');
        grid.innerHTML = tools.map(renderCard).join('');
        animateCards(grid);
      }

      function renderArticlesGrid(articles) {
        const grid = widget.querySelector('#article-grid');
        grid.innerHTML = articles.map(renderCard).join('');
        animateCards(grid);

        const filterCategory = widget.querySelector('#filter-category');
        const filterPosition = widget.querySelector('#filter-position');
        const filterTeam = widget.querySelector('#filter-team');
        const filterLocked = widget.querySelector('#filter-locked');
        const filterAuthor = widget.querySelector('#filter-author');
        const search = widget.querySelector('#search');
        applyBookmarkStates();
      }

      function renderCard(a) {
        const isPremium = a.premium === 'Subscriber Only' || a.locked;
        const isTool = String(a.category).trim().toLowerCase() === 'tools';
        const isAudio = String(a.category).trim().toLowerCase() === 'podcasts';
        const isNew = isPublishedToday(a.publishDate);
        const overlayIcon = isTool
          ? '<img src="https://media.pff.com/staging/2025/07/Tools.png" alt="Tool" class="overlay-icon">'
          : isAudio
            ? '<img src="https://media.pff.com/staging/2025/07/Daco_4392968.png" alt="Audio" class="overlay-icon">'
            : isPremium
              ? '<img src="https://media.pff.com/staging/2025/07/PFF.png" alt="PFF+" class="overlay-icon">'
              : '';

        const safeUrl = escapeAttr(a.url);
        const safeHeadline = escapeHtml(a.headline);
        const safeHeadlineAttr = escapeAttr(a.headline);

        const isNewCard = !isTool && isNew;
        return `
          <div class="card ${isPremium ? 'premium' : ''} ${isTool ? 'tool' : ''} ${isAudio ? 'podcast' : ''} ${isNewCard ? 'is-new' : ''}" data-url="${safeUrl}" onclick="handleCardClick(event, '${safeUrl.replace(/'/g, "\\'")}')">
            <div class="card-overlay">${overlayIcon}</div>
            <a href="${safeUrl}" class="card-title" target="_blank">${safeHeadline}</a>
            ${!isTool ? '<div class="card-author">by ' + escapeHtml(a.author) + '</div>' : ''}
            ${!isTool ? '<div class="card-date">' + a.publishDate.toLocaleDateString() + '</div>' : ''}
            ${isNewCard ? '<div class="badge">NEW</div>' : ''}
            ${!isTool ? `<div class="card-actions" style="position:absolute; bottom:8px; right:8px; display:flex; gap:10px;">
              <button class="icon-button" onclick="event.stopPropagation(); shareContent('${safeUrl.replace(/'/g, "\\'")}', '${safeHeadlineAttr.replace(/'/g, "\\'")}')">
                <img src="https://media.pff.com/staging/2025/07/ios-share-zmjqh7inc2jqwfwm5f8.png" alt="Share">
              </button>
              <button class="icon-button bookmark-button" onclick="event.stopPropagation(); toggleBookmark('${safeUrl.replace(/'/g, "\\'")}', this)">
                <img src="https://media.pff.com/staging/2025/07/Bookmark.png" alt="Bookmark">
              </button>
            </div>` : ''}
          </div>
        `;
      }

      function animateCards(grid) {
        const cards = grid.querySelectorAll('.card');
        cards.forEach((card, index) => {
          setTimeout(() => card.classList.add('visible'), index * 80);
        });
      }

      function applyBookmarkStates() {
        const bookmarks = JSON.parse(localStorage.getItem('bookmarks') || '[]');
        document.querySelectorAll('.bookmark-button').forEach(button => {
          const card = button.closest('.card');
          const url = card && card.getAttribute('data-url');
          if (url && bookmarks.includes(url)) {
            button.classList.add('active');
          } else {
            button.classList.remove('active');
          }
        });
      }

      function renderFilters() {
        const categories = [...new Set(regularArticles.map(a => a.category).filter(Boolean))].sort();
        const positions = [...new Set(regularArticles.map(a => a.positionalFocus).filter(Boolean))].sort();
        const teams = [...new Set(regularArticles.map(a => a.nflTeam).filter(Boolean))].sort();
        const authors = [...new Set(regularArticles.map(a => a.author).filter(Boolean))].sort();

        const filtersHTML = `
          <select id="filter-category">
            <option value="">All Categories</option>
            ${categories.map(c => `<option value="${escapeAttr(c)}">${escapeHtml(c)}</option>`).join('')}
          </select>
          <select id="filter-position">
            <option value="">Position</option>
            ${positions.map(p => `<option value="${escapeAttr(p)}">${escapeHtml(p)}</option>`).join('')}
          </select>
          <select id="filter-team">
            <option value="">NFL Team</option>
            ${teams.map(t => `<option value="${escapeAttr(t)}">${escapeHtml(t)}</option>`).join('')}
          </select>
          <select id="filter-locked">
            <option value="">Access</option>
            <option value="Free">Free</option>
            <option value="Subscriber Only">Subscriber Only</option>
          </select>
          <select id="filter-author">
            <option value="">All Authors</option>
            ${authors.map(a => `<option value="${escapeAttr(a)}">${escapeHtml(a)}</option>`).join('')}
          </select>
          <input type="text" id="search" placeholder="Search headlines..." />
          <button id="clear-filters">Clear All</button>
        `;
        widget.querySelector('.filters').innerHTML = filtersHTML;

        const filters = widget.querySelectorAll('.filters select, .filters input');
        filters.forEach(el =>
          el.addEventListener('input', () => renderArticlesGrid(filterRegularArticles()))
        );
        filters.forEach(el =>
          el.addEventListener('change', () => renderArticlesGrid(filterRegularArticles()))
        );

        document.getElementById('clear-filters').addEventListener('click', clearAllFilters);
      }

      function clearAllFilters() {
        var ids = ['filter-category', 'filter-position', 'filter-team', 'filter-locked', 'filter-author', 'search'];
        ids.forEach(function(id) {
          var el = document.getElementById(id);
          if (el) el.value = '';
        });
        renderArticlesGrid(regularArticles);
      }

      function norm(s) {
        return String(s || '').trim().toLowerCase().replace(/\s+/g, ' ');
      }

      function filterRegularArticles() {
        const cat = (widget.querySelector('#filter-category')?.value || '').trim();
        const pos = (widget.querySelector('#filter-position')?.value || '').trim();
        const team = (widget.querySelector('#filter-team')?.value || '').trim();
        const locked = (widget.querySelector('#filter-locked')?.value || '').trim();
        const auth = (widget.querySelector('#filter-author')?.value || '').trim();
        const search = (widget.querySelector('#search')?.value || '').toLowerCase().trim();

        return regularArticles.filter(function(a) {
          return (!cat || norm(a.category) === norm(cat)) &&
            (!pos || norm(a.positionalFocus) === norm(pos)) &&
            (!team || norm(a.nflTeam) === norm(team)) &&
            (!locked || String(a.premium || '').trim() === locked) &&
            (!auth || norm(a.author) === norm(auth)) &&
            (a.headline || '').toLowerCase().indexOf(search) !== -1;
        });
      }

      /** Build filtered list using a known value for one filter (from chat click). Uses norm() so matching is case-insensitive and whitespace-tolerant. */
      function getFilteredForChat(filterId, value) {
        var cat = (filterId === 'filter-category' ? value : (widget.querySelector('#filter-category')?.value || '')).trim();
        var pos = (filterId === 'filter-position' ? value : (widget.querySelector('#filter-position')?.value || '')).trim();
        var team = (filterId === 'filter-team' ? value : (widget.querySelector('#filter-team')?.value || '')).trim();
        var locked = (filterId === 'filter-locked' ? value : (widget.querySelector('#filter-locked')?.value || '')).trim();
        var auth = (filterId === 'filter-author' ? value : (widget.querySelector('#filter-author')?.value || '')).trim();
        var search = (widget.querySelector('#search')?.value || '').toLowerCase().trim();
        return regularArticles.filter(function(a) {
          return (!cat || norm(a.category) === norm(cat)) &&
            (!pos || norm(a.positionalFocus) === norm(pos)) &&
            (!team || norm(a.nflTeam) === norm(team)) &&
            (!locked || String(a.premium || '').trim() === locked) &&
            (!auth || norm(a.author) === norm(auth)) &&
            (a.headline || '').toLowerCase().indexOf(search) !== -1;
        });
      }

      function initTrevorChatbot() {
        const overlay = widget.querySelector('#trevor-modal-overlay');
        const chatMessages = widget.querySelector('#trevor-chat-messages');
        const chipsContainer = widget.querySelector('#trevor-chips');

        const categories = [...new Set(regularArticles.map(a => a.category).filter(Boolean))].sort();
        const positions = [...new Set(regularArticles.map(a => a.positionalFocus).filter(Boolean))].sort();
        const teams = [...new Set(regularArticles.map(a => a.nflTeam).filter(Boolean))].sort();
        const authors = [...new Set(regularArticles.map(a => a.author).filter(Boolean))].sort();

        function getModalFocusables() {
          var modal = overlay.querySelector('#trevor-modal');
          if (!modal) return [];
          var list = [];
          var closeBtn = modal.querySelector('.modal-close');
          if (closeBtn) list.push(closeBtn);
          var chips = modal.querySelectorAll('#trevor-chips .chat-chip');
          for (var i = 0; i < chips.length; i++) list.push(chips[i]);
          return list;
        }

        function openModal() {
          overlay.classList.add('is-open');
          overlay.setAttribute('aria-hidden', 'false');
          startChat();
          setTimeout(function() {
            var focusables = getModalFocusables();
            if (focusables.length > 1) {
              focusables[1].focus();
            } else if (focusables.length > 0) {
              focusables[0].focus();
            }
          }, 0);
        }

        function closeModal() {
          overlay.classList.remove('is-open');
          overlay.setAttribute('aria-hidden', 'true');
        }

        var TYPING_DELAY_MS = 700;

        var MAX_ARTICLES_IN_CHAT = 15;

        function playResponseSound() {
          try {
            var Ctx = window.AudioContext || window.webkitAudioContext;
            if (!Ctx) return;
            var ctx = new Ctx();
            var osc = ctx.createOscillator();
            var gain = ctx.createGain();
            osc.connect(gain);
            gain.connect(ctx.destination);
            osc.frequency.value = 520;
            osc.type = 'sine';
            gain.gain.setValueAtTime(0.12, ctx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.001, ctx.currentTime + 0.1);
            osc.start(ctx.currentTime);
            osc.stop(ctx.currentTime + 0.1);
          } catch (e) {}
        }

        function playExcitingResponseSound() {
          try {
            var Ctx = window.AudioContext || window.webkitAudioContext;
            if (!Ctx) return;
            var ctx = new Ctx();
            var notes = [523.25, 659.25, 783.99, 1046.50];
            var t0 = ctx.currentTime;
            notes.forEach(function(hz, i) {
              var osc = ctx.createOscillator();
              var gain = ctx.createGain();
              osc.connect(gain);
              gain.connect(ctx.destination);
              osc.frequency.value = hz;
              osc.type = 'sine';
              var start = t0 + i * 0.12;
              gain.gain.setValueAtTime(0, start);
              gain.gain.linearRampToValueAtTime(0.18, start + 0.02);
              gain.gain.exponentialRampToValueAtTime(0.001, start + 0.2);
              osc.start(start);
              osc.stop(start + 0.2);
            });
          } catch (e) {}
        }

        function addBotMessage(text, withTyping) {
          const div = document.createElement('div');
          div.className = 'msg msg-bot';
          if (withTyping) {
            div.innerHTML = '<img class="msg-avatar" src="' + escapeAttr(TREVOR_IMG) + '" alt=""> <div class="msg-bubble"><div class="typing-dots"><span></span><span></span><span></span></div></div>';
            chatMessages.appendChild(div);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            setTimeout(function() {
              var bubble = div.querySelector('.msg-bubble');
              if (bubble) {
                bubble.innerHTML = escapeHtml(text);
              }
              chatMessages.scrollTop = chatMessages.scrollHeight;
              playResponseSound();
            }, TYPING_DELAY_MS);
          } else {
            div.innerHTML = '<img class="msg-avatar" src="' + escapeAttr(TREVOR_IMG) + '" alt=""> <div class="msg-bubble">' + escapeHtml(text) + '</div>';
            chatMessages.appendChild(div);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            playResponseSound();
          }
        }

        function addBotMessageDoneWithArticles(articles) {
          var div = document.createElement('div');
          div.className = 'msg msg-bot';
          div.innerHTML = '<img class="msg-avatar" src="' + escapeAttr(TREVOR_IMG) + '" alt=""> <div class="msg-bubble"><div class="typing-dots"><span></span><span></span><span></span></div></div>';
          chatMessages.appendChild(div);
          chatMessages.scrollTop = chatMessages.scrollHeight;
          setTimeout(function() {
            var bubble = div.querySelector('.msg-bubble');
            if (!bubble) return;
            var subscribeUrl = 'https://subscribe.pff.com/?promoCode=draftkit25';
            var html = 'Done! Check out the articles below.';
            if (articles && articles.length > 0) {
              var list = articles.slice(0, MAX_ARTICLES_IN_CHAT);
              html += '<div class="trevor-article-links">';
              list.forEach(function(a) {
                var url = (a.url || '').trim();
                var headline = (a.headline || 'Article').trim();
                if (url) {
                  html += '<a href="' + escapeAttr(url) + '" target="_blank" rel="noopener noreferrer" class="trevor-article-link">' + escapeHtml(headline) + '</a>';
                }
              });
              html += '</div>';
              if (articles.length > MAX_ARTICLES_IN_CHAT) {
                html += '<p style="margin-top:8px;font-size:11px;opacity:0.8;">+' + (articles.length - MAX_ARTICLES_IN_CHAT) + ' more in the grid below.</p>';
              }
            } else {
              html += '<p style="margin-top:8px;font-size:12px;opacity:0.85;">No articles matched in the chat — check the grid below.</p>';
            }
            html += '<p class="trevor-cta-pff" style="margin-top:12px;margin-bottom:0;font-size:13px;font-weight:600;"><a href="' + escapeAttr(subscribeUrl) + '" target="_blank" rel="noopener noreferrer">Get full access to everything with PFF+ →</a></p>';
            bubble.innerHTML = html;
            chatMessages.scrollTop = chatMessages.scrollHeight;
            playResponseSound();
          }, TYPING_DELAY_MS);
        }

        function addUserMessage(text) {
          const div = document.createElement('div');
          div.className = 'msg msg-user';
          div.innerHTML = '<div class="msg-bubble">' + escapeHtml(text) + '</div>';
          chatMessages.appendChild(div);
          chatMessages.scrollTop = chatMessages.scrollHeight;
        }

        function setChips(items) {
          chipsContainer.innerHTML = '';
          items.forEach(function(item) {
            const btn = document.createElement('button');
            btn.type = 'button';
            btn.className = 'chat-chip' + (item.surprise ? ' chip-surprise' : '') + (item.back ? ' chip-back' : '');
            btn.textContent = item.label;
            if (item.branch && !item.back) {
              btn.dataset.branch = item.branch;
              btn.addEventListener('click', function() { onChipBranch(btn.dataset.branch, item.label); });
            } else if (item.filterId && item.value !== undefined) {
              btn.dataset.filterId = item.filterId;
              btn.dataset.value = item.value;
              btn.addEventListener('click', function() { onChipFilter(btn.dataset.filterId, btn.dataset.value, item.label); });
            }
            chipsContainer.appendChild(btn);
          });
        }

        function onChipBranch(branch, label) {
          addUserMessage(label);
          if (branch === 'search') {
            addBotMessage('Type in the search box above the articles — I\'ve focused it for you.', true);
            setChips([]);
            closeModal();
            setTimeout(function() {
              const searchEl = widget.querySelector('#search');
              if (searchEl) searchEl.focus();
            }, 100);
            return;
          }
          if (branch === 'surprise') {
            const filtered = filterRegularArticles();
            const list = filtered.length ? filtered : regularArticles;
            if (list.length) {
              const random = list[Math.floor(Math.random() * list.length)];
              renderArticlesGrid([random]);
              addBotMessageDoneWithArticles([random]);
            } else {
              addBotMessage('No articles to pick from right now.', true);
            }
            setChips([{ label: '← Start over', back: true }]);
            chipsContainer.querySelector('.chip-back').addEventListener('click', function() { startChat(); });
            return;
          }
          if (branch === '__start') {
            startChat();
            return;
          }
          if (branch === 'newest') {
            onChipNewestArticles();
            return;
          }
          if (branch === 'bookmarks') {
            var bookmarks = [];
            try {
              bookmarks = JSON.parse(localStorage.getItem('bookmarks') || '[]');
            } catch (e) {}
            var bookmarked = regularArticles.filter(function(a) {
              var url = (a.url || '').trim();
              return url && bookmarks.indexOf(url) !== -1;
            });
            if (bookmarked.length) {
              clearAllFilters();
              renderArticlesGrid(bookmarked);
              addBotMessageDoneWithArticles(bookmarked);
            } else {
              addBotMessage('You haven\'t saved any articles yet. Bookmark some from the grid!', true);
            }
            setChips([{ label: '← Start over', back: true }]);
            var backBtn = chipsContainer.querySelector('.chip-back');
            if (backBtn) backBtn.addEventListener('click', function() { startChat(); });
            return;
          }
          if (branch === 'drafttools') {
            var div = document.createElement('div');
            div.className = 'msg msg-bot';
            div.innerHTML = '<img class="msg-avatar" src="' + escapeAttr(TREVOR_IMG) + '" alt=""> <div class="msg-bubble"><div class="typing-dots"><span></span><span></span><span></span></div></div>';
            chatMessages.appendChild(div);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            setTimeout(function() {
              var bubble = div.querySelector('.msg-bubble');
              if (!bubble) return;
              var intro = 'Sure, what do you like?';
              var tools = [
                { title: 'MDS Multiplayer', desc: 'Draft together in real time with your friends using our best-in-class Mock Draft Simulator. Build a group, go head-to-head, trade picks, and see who truly has the best draft strategy—all while turning your mock into a competitive draft party experience.', url: 'https://www.pff.com/draft/nfl-mock-draft-simulator' },
                { title: 'Leaderboards', desc: 'See where the consensus stands with live average draft positions pulled directly from user data in the Mock Draft Simulator. Track trends overall and by round to understand how the board is shaping up.', url: 'https://www.pff.com/draft/nfl-mock-draft-simulator' },
                { title: 'Mock Draft Simulator', desc: 'Be the GM for any team in the 2026 NFL Draft with a fully immersive simulation that lets you trade picks and players for a realistic, in-depth draft experience.', url: 'https://www.pff.com/draft/nfl-mock-draft-simulator' },
                { title: 'Big Board', desc: 'Trevor Sikkema\'s personal rankings, complete with three-year player grades, position rankings and in-depth scouting reports for the top prospects in the class.', url: 'https://www.pff.com/draft/big-board' },
                { title: 'Scouting Assistant', desc: 'Create your own customized draft rankings, with Scouting Mode at its core — a fully customizable grading system that puts the entire evaluation process in your hands.', url: 'https://www.pff.com/news/draft-2026-nfl-draft-big-board-builder' },
                { title: 'College Football Premium Stats', desc: 'Our exclusive database, featuring the most in-depth collection of NCAA player performance data.', url: 'https://premium.pff.com/ncaa/teams' }
              ];
              var html = escapeHtml(intro) + '<div class="trevor-tool-list">';
              tools.forEach(function(t) {
                var url = (t.url || '').trim();
                if (url) {
                  html += '<a href="' + escapeAttr(url) + '" target="_blank" rel="noopener noreferrer" class="trevor-tool-item trevor-tool-link"><div class="trevor-tool-title">' + escapeHtml(t.title) + '</div><div class="trevor-tool-desc">' + escapeHtml(t.desc) + '</div></a>';
                } else {
                  html += '<div class="trevor-tool-item"><div class="trevor-tool-title">' + escapeHtml(t.title) + '</div><div class="trevor-tool-desc">' + escapeHtml(t.desc) + '</div></div>';
                }
              });
              html += '</div>';
              bubble.innerHTML = html;
              chatMessages.scrollTop = chatMessages.scrollHeight;
              playResponseSound();
            }, TYPING_DELAY_MS);
            setChips([{ label: '← Start over', back: true }]);
            chipsContainer.querySelector('.chip-back').addEventListener('click', function() { startChat(); });
            return;
          }
          if (branch === 'discount') {
            var discountCopy = 'Sure! Use code DRAFTKIT25 to save 25% on PFF. Get the annual plan for $89.99 (just $7.49 per month) or the monthly plan for $18.74 per month.';
            var discountCode = 'DRAFTKIT25';
            var discountUrl = 'https://subscribe.pff.com/?promoCode=draftkit25';
            var div = document.createElement('div');
            div.className = 'msg msg-bot';
            div.innerHTML = '<img class="msg-avatar" src="' + escapeAttr(TREVOR_IMG) + '" alt=""> <div class="msg-bubble"><div class="typing-dots"><span></span><span></span><span></span></div></div>';
            chatMessages.appendChild(div);
            chatMessages.scrollTop = chatMessages.scrollHeight;
            setTimeout(function() {
              var bubble = div.querySelector('.msg-bubble');
              if (bubble) {
                bubble.innerHTML = escapeHtml(discountCopy) +
                  '<div class="trevor-actions">' +
                  '<button type="button" class="trevor-btn trevor-btn-copy">Copy code</button>' +
                  '<a href="' + escapeAttr(discountUrl) + '" target="_blank" rel="noopener noreferrer" class="trevor-btn trevor-btn-link">Subscribe at PFF</a>' +
                  '</div>';
                var copyBtn = bubble.querySelector('.trevor-btn-copy');
                if (copyBtn) {
                  copyBtn.addEventListener('click', function() {
                    var overlay = copyBtn.closest('#trevor-modal-overlay');
                    playCopyConfetti(overlay || document.body);
                    navigator.clipboard.writeText(discountCode).then(function() {
                      copyBtn.textContent = 'Copied!';
                      copyBtn.classList.add('copied');
                      setTimeout(function() {
                        copyBtn.textContent = 'Copy code';
                        copyBtn.classList.remove('copied');
                      }, 2000);
                    }).catch(function() {
                      copyBtn.textContent = 'Copied!';
                      copyBtn.classList.add('copied');
                      setTimeout(function() { copyBtn.textContent = 'Copy code'; copyBtn.classList.remove('copied'); }, 2000);
                    });
                  });
                }
              }
              chatMessages.scrollTop = chatMessages.scrollHeight;
              playExcitingResponseSound();
            }, TYPING_DELAY_MS);
            setChips([{ label: '← Start over', back: true }]);
            chipsContainer.querySelector('.chip-back').addEventListener('click', function() { startChat(); });
            return;
          }
          showBranchChips(branch);
        }

        function onChipNewestArticles() {
          addUserMessage('Show me your newest articles');
          var newest = regularArticles.filter(function(a) {
            return isPublishedToday(a.publishDate);
          });
          renderArticlesGrid(newest);
          addBotMessageDoneWithArticles(newest);
          setChips([{ label: '← Start over', back: true }]);
          chipsContainer.querySelector('.chip-back').addEventListener('click', function() { startChat(); });
        }

        function onChipFilter(filterId, value, label) {
          addUserMessage(label);
          const filterEl = widget.querySelector('#' + filterId);
          if (filterEl) {
            filterEl.value = value;
          }
          var filtered = getFilteredForChat(filterId, value);
          renderArticlesGrid(filtered);
          addBotMessageDoneWithArticles(filtered);
          setChips([{ label: '← Start over', back: true }]);
          chipsContainer.querySelector('.chip-back').addEventListener('click', function() { startChat(); });
        }

        function applyInlineChoice(filterId, value, label) {
          addUserMessage(label);
          var filterEl = widget.querySelector('#' + filterId);
          if (filterEl) {
            filterEl.value = value;
          }
          var filtered = getFilteredForChat(filterId, value);
          renderArticlesGrid(filtered);
          addBotMessageDoneWithArticles(filtered);
          setChips([{ label: '← Start over', back: true }]);
          chipsContainer.querySelector('.chip-back').addEventListener('click', function() { startChat(); });
        }

        function showBranchChips(branch) {
          var prompt = '';
          var options = [];
          var filterId = '';
          if (branch === 'category') {
            prompt = 'Pick a category:';
            options = categories;
            filterId = 'filter-category';
          } else if (branch === 'position') {
            prompt = 'Pick a position:';
            options = positions;
            filterId = 'filter-position';
          } else if (branch === 'team') {
            prompt = 'Pick an NFL team:';
            options = teams;
            filterId = 'filter-team';
          } else if (branch === 'access') {
            prompt = 'Free or subscriber only?';
            options = ['Free', 'Subscriber Only'];
            filterId = 'filter-locked';
          } else if (branch === 'author') {
            prompt = 'Pick an author:';
            options = authors;
            filterId = 'filter-author';
          }
          setChips([]);
          var div = document.createElement('div');
          div.className = 'msg msg-bot';
          div.innerHTML = '<img class="msg-avatar" src="' + escapeAttr(TREVOR_IMG) + '" alt=""> <div class="msg-bubble"><div class="typing-dots"><span></span><span></span><span></span></div></div>';
          chatMessages.appendChild(div);
          chatMessages.scrollTop = chatMessages.scrollHeight;
          setTimeout(function() {
            var bubble = div.querySelector('.msg-bubble');
            if (!bubble) return;
            var optsHtml = escapeHtml(prompt) + '<div class="trevor-inline-options">';
            options.forEach(function(val) {
              optsHtml += '<button type="button" class="trevor-option-btn" data-filter-id="' + escapeAttr(filterId) + '" data-value="' + escapeAttr(val) + '" data-label="' + escapeAttr(val) + '">' + escapeHtml(val) + '</button>';
            });
            optsHtml += '<button type="button" class="trevor-option-btn trevor-option-back">← Back</button></div>';
            bubble.innerHTML = optsHtml;
            bubble.querySelectorAll('.trevor-option-btn:not(.trevor-option-back)').forEach(function(btn) {
              btn.addEventListener('click', function() {
                applyInlineChoice(btn.dataset.filterId, btn.dataset.value, btn.dataset.label);
              });
            });
            var backBtn = bubble.querySelector('.trevor-option-back');
            if (backBtn) {
              backBtn.addEventListener('click', function() {
                chatMessages.removeChild(chatMessages.lastElementChild);
                chatMessages.removeChild(chatMessages.lastElementChild);
                showFirstStepChips();
              });
            }
            chatMessages.scrollTop = chatMessages.scrollHeight;
            playResponseSound();
          }, TYPING_DELAY_MS);
        }

        function showFirstStepChips() {
          setChips([
            { label: 'Can I have a PFF+ discount code?', branch: 'discount' },
            { label: 'I want draft tools', branch: 'drafttools' },
            { label: 'Show me your newest articles', branch: 'newest' },
            { label: 'Show my saved articles', branch: 'bookmarks' },
            { label: 'I want to search by article type', branch: 'category' },
            { label: 'I want to scout by position', branch: 'position' },
            { label: 'I want to look for my NFL team', branch: 'team' },
            { label: 'I want to look for articles by author', branch: 'author' },
            { label: 'I want to search for something', branch: 'search' },
            { label: 'Surprise me!', branch: 'surprise', surprise: true }
          ]);
        }

        function startChat() {
          clearAllFilters();
          chatMessages.innerHTML = '';
          chipsContainer.innerHTML = '';
          addBotMessage('What can I help you find today?', true);
          showFirstStepChips();
        }

        widget.querySelector('#trevor-help-banner').addEventListener('click', openModal);
        widget.querySelector('#trevor-help-banner').addEventListener('keydown', function(e) {
          if (e.key === 'Enter' || e.key === ' ') {
            e.preventDefault();
            openModal();
          }
        });
        overlay.querySelector('.modal-close').addEventListener('click', closeModal);
        overlay.addEventListener('click', function(e) {
          if (e.target === overlay) closeModal();
        });
        document.addEventListener('keydown', function onKey(e) {
          if (e.key === 'Escape' && overlay.classList.contains('is-open')) {
            closeModal();
          }
        });

        overlay.addEventListener('keydown', function modalKeydown(e) {
          if (!overlay.classList.contains('is-open')) return;
          var modal = overlay.querySelector('#trevor-modal');
          if (!modal || !modal.contains(e.target)) return;
          var focusables = getModalFocusables();
          var idx = -1;
          for (var i = 0; i < focusables.length; i++) {
            if (focusables[i] === e.target) { idx = i; break; }
          }
          var isChip = e.target.classList && e.target.classList.contains('chat-chip');

          if (e.key === 'Enter' && isChip) {
            e.preventDefault();
            e.target.click();
            return;
          }
          if (e.key === 'ArrowDown' || e.key === 'ArrowRight') {
            if (isChip && idx >= 0) {
              e.preventDefault();
              var next = idx + 1;
              if (next < focusables.length) focusables[next].focus();
              return;
            }
          }
          if (e.key === 'ArrowUp' || e.key === 'ArrowLeft') {
            if (isChip && idx >= 0) {
              e.preventDefault();
              var prev = idx - 1;
              if (prev >= 0) focusables[prev].focus();
              return;
            }
          }
          if (e.key === 'Tab') {
            if (focusables.length === 0) return;
            if (!e.shiftKey && e.target === focusables[focusables.length - 1]) {
              e.preventDefault();
              focusables[0].focus();
            } else if (e.shiftKey && e.target === focusables[0]) {
              e.preventDefault();
              focusables[focusables.length - 1].focus();
            }
          }
        });
      }

      window.applyBookmarkStates = applyBookmarkStates;
    }

    window.handleCardClick = function(event, url) {
      const card = event.currentTarget;
      const ripple = document.createElement('span');
      ripple.classList.add('ripple');
      const rect = card.getBoundingClientRect();
      ripple.style.left = (event.clientX - rect.left) + 'px';
      ripple.style.top = (event.clientY - rect.top) + 'px';
      ripple.style.width = ripple.style.height = '20px';
      ripple.style.marginLeft = ripple.style.marginTop = '-10px';
      card.appendChild(ripple);
      setTimeout(() => ripple.remove(), 600);
      if (!event.target.closest('button')) {
        window.open(url, '_blank');
      }
    };

    function shareContent(url, title) {
      if (navigator.share) {
        navigator.share({
          title: title,
          text: `Check this out: ${title}`,
          url: url
        }).catch(err => console.log('Web Share failed', err));
      } else {
        navigator.clipboard.writeText(url)
          .then(() => alert('Link copied to clipboard!'))
          .catch(err => console.log('Clipboard copy failed', err));
      }
    }

    function toggleBookmark(url, button) {
      let bookmarks = JSON.parse(localStorage.getItem('bookmarks') || '[]');
      const index = bookmarks.indexOf(url);
      if (index === -1) {
        bookmarks.push(url);
        button.classList.add('active');
      } else {
        bookmarks.splice(index, 1);
        button.classList.remove('active');
      }
      localStorage.setItem('bookmarks', JSON.stringify(bookmarks));
    }

    loadDraftKit();
  </script>
</body>
</html>
