<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<title>Indianapolis Colts at Baltimore Ravens — Game Recap</title>
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Archivo:wght@600;700;800&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #070b10; --text: #ffffff; --muted: rgba(255,255,255,.7);
    --pill: #0A66FF; --pill-press: #095AE0; --radius: 18px;
    --pad: max(16px, env(safe-area-inset-left)); --padR: max(16px, env(safe-area-inset-right));
    --maxw: 650px;
    --card-h: 520px; --head-h: 56px; --meta-h: 40px; --content-h: calc(var(--card-h) - var(--head-h) - var(--meta-h));
  }
  * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; }
  html, body { height: 100%; background: var(--bg); }
  body { margin: 0; font-family: "Archivo", system-ui, -apple-system, Segoe UI, Roboto, Helvetica, Arial, sans-serif; color: var(--text); line-height: 1.2; }
  .wrap { padding: calc(12px + env(safe-area-inset-top)) var(--padR) calc(16px + env(safe-area-inset-bottom)) var(--pad); max-width: var(--maxw); margin: 0 auto; }
  .banner { position: relative; border-radius: var(--radius); overflow: hidden; background: url("https://raw.githubusercontent.com/markchichester/PFF_Chichester/main/SubscriptionModule_V1.png") center/cover no-repeat, #0c1220; box-shadow: 0 12px 36px rgba(0,0,0,.45); }
  .veil { background: linear-gradient(180deg, rgba(0,0,0,.20) 0%, rgba(7,11,16,.85) 60%, rgba(7,11,16,.95) 100%);
          padding: 18px 14px clamp(90px, 18vw, 128px); }
  .topline { display: flex; justify-content: center; gap: 8px; font-size: 12.5px; text-transform: uppercase; letter-spacing: .05em; color: var(--muted); }
  .matchup { display: grid; grid-template-columns: minmax(0,1fr) auto minmax(0,1fr); align-items: center; gap: 10px; margin: 10px 0 14px; }
  .team { display: grid; grid-template-columns: 56px 1fr; gap: 8px; align-items: center; min-width: 0; }
  .team.right { grid-template-columns: 1fr 56px; text-align: right; }
  .logo { width: 56px; height: 56px; padding: 6px; background: rgba(255,255,255,.08); border-radius: 14px; backdrop-filter: blur(2px); }
  .logo img { width: 100%; height: 100%; max-width: 100%; max-height: 100%; object-fit: contain; }
  .name { display: flex; flex-direction: column; align-items: flex-start; gap: 2px; min-width: 0; }
  .team.right .name { align-items: flex-end; }
  .name .city   { font-weight: 700; font-size: clamp(12px, 3.6vw, 14px); letter-spacing: .02em; opacity: .92; }
  .name .mascot { font-weight: 800; font-size: clamp(16px, 5vw, 20px); line-height: 1.05; }
  .score { display: flex; align-items: center; justify-content: center; gap: 8px; min-width: 110px; }
  .score .num { font-size: clamp(36px, 10vw, 52px); font-weight: 800; line-height: .95; }
  .score .dash { opacity: .7; font-size: clamp(18px, 5vw, 24px); }
  .cta { display: flex; justify-content: center; }
  .cta a {
    position: relative; display: inline-flex; align-items: center; justify-content: center;
    min-height: 48px; padding: 0 18px; border-radius: 999px; background: var(--pill); color: #fff; text-decoration: none;
    font-weight: 800; font-size: 16px; letter-spacing: .01em; box-shadow: 0 8px 20px rgba(10,102,255,.35), inset 0 -2px 0 rgba(255,255,255,.22);
    touch-action: manipulation; will-change: transform, box-shadow; transform: translateZ(0);
    transition: transform .12s ease, box-shadow .18s ease, background-color .12s ease; overflow: hidden;
  }
  .cta a:hover { transform: translateY(-1px) scale(1.012); box-shadow: 0 12px 26px rgba(10,102,255,.38); }
  .cta a:active { transform: translateY(0) scale(.985); background: var(--pill-press); box-shadow: 0 6px 16px rgba(10,102,255,.34); }
  .cta a:focus-visible { outline: 0; box-shadow: 0 0 0 3px rgba(10,102,255,.45), 0 8px 22px rgba(10,102,255,.36); }
  .cta a::after { content: ""; position: absolute; inset: 0; background: radial-gradient(circle at var(--x,50%) var(--y,50%), rgba(255,255,255,.45), transparent 40%); opacity: 0; transform: scale(0); transition: opacity .2s ease, transform .2s ease; pointer-events: none; }
  .cta a:active::after { opacity: .32; transform: scale(1); transition: none; }
  img.powered { position: absolute; left: 50%; transform: translateX(-50%); bottom: 10px; width: clamp(120px, 28vw, 180px) !important; height: auto !important; pointer-events: none; z-index: 2; }

  /* Swipe track */
  .page{max-width: var(--maxw); margin: 0 auto; padding: 16px}
  .track{display:flex; gap:12px; overflow-x:auto; scroll-snap-type:x mandatory; scroll-padding:16px; -webkit-overflow-scrolling:touch; padding-bottom:6px; scrollbar-width:none}
  .track::-webkit-scrollbar{display:none}
  .slide{scroll-snap-align:start; flex:0 0 88%; max-width:88%}
  .card{height:var(--card-h); display:flex; flex-direction:column; background:linear-gradient(180deg, rgba(255,255,255,.04), transparent), #0e1624; border:1px solid rgba(255,255,255,.08); border-radius:16px; overflow:hidden; box-shadow:0 10px 24px rgba(0,0,0,.35)}
  .head{flex:0 0 var(--head-h); display:flex; justify-content:center; gap:16px; align-items:center; padding:10px 12px; border-bottom:1px solid rgba(255,255,255,.08)}
  .badge{display:flex; align-items:center; gap:8px; font-weight:800; font-size:13px; color:#fff; white-space:nowrap; min-width:0; overflow:hidden}
  .badge img{width:18px; height:18px; max-width:18px; max-height:18px; object-fit:contain; border-radius:4px; background:#0a0f18; padding:2px}
  .sep{opacity:.5; font-size:12px}
  .content{flex:1 1 auto; min-height:var(--content-h); max-height:var(--content-h); overflow:hidden}
  .chart{display:block; width:100%; height:100%; background:linear-gradient(180deg, #0f1a2a, #0c1626)}
  .pad{height:100%; padding:12px; overflow:auto; display:flex; flex-direction:column; gap:12px}
  .firstdowns{gap:32px}
  .meta{flex:0 0 var(--meta-h); display:flex; justify-content:space-between; align-items:center; padding:10px 12px; font-size:12px; color:rgba(255,255,255,.78); border-top:1px solid rgba(255,255,255,.06)}

  /* KPI & Drives — single column (one per row) */
  #kpis-1 .kpi-grid{display:grid; grid-template-columns:1fr; gap:10px}
  .kpi{background:rgba(255,255,255,.04); border:1px solid rgba(255,255,255,.08); border-radius:12px; padding:12px}
  .kpi .label{font-size:12px; color:rgba(255,255,255,.78); margin-bottom:8px; white-space:normal}
  .rowv{display:flex; justify-content:space-between; align-items:center; gap:8px}
  .v{display:flex; align-items:center; gap:8px; font-weight:800; font-size:18px; color:#fff}
  .v img{width:16px; height:16px; object-fit:contain; border-radius:3px; background:#0a0f18; padding:1px}

  .split2{display:grid; grid-template-columns:1fr 1fr; gap:10px}
  #drives .split2{display:grid; grid-template-columns:1fr; gap:10px}
  .tile{background:rgba(255,255,255,.04); border:1px solid rgba(255,255,255,.08); border-radius:12px; padding:12px}
  .tile h4{margin:0 0 6px; font-size:12px; color:rgba(255,255,255,.78)}
  .rowpair{display:flex; justify-content:space-between; align-items:center; margin:6px 0}
  .tag{display:flex; align-items:center; gap:6px; font-weight:800; font-size:13px; color:#fff}
  .tag img{width:16px; height:16px; object-fit:contain; border-radius:3px; background:#0a0f18; padding:1px}
  .big{font-size:20px; font-weight:800; color:#fff}

  /* First downs bars */
  .metric{display:flex; flex-direction:column; gap:10px}
  .lbl{font-size:12px; color:rgba(255,255,255,.78)}
  .teamrow{display:grid; grid-template-columns: auto 1fr auto; gap:12px; align-items:center}
  .teamname{font-size:13px; font-weight:800; color:#fff; white-space:nowrap; overflow:hidden; text-overflow:ellipsis}
  .bar{height:22px; border-radius:11px; background:rgba(255,255,255,.10); overflow:hidden; position:relative}
  .fill{position:absolute; left:0; top:0; bottom:0; background:rgba(255,255,255,.92)}
  .val{font-size:12px; font-weight:800; color:#fff; min-width:40px; text-align:right}

  /* More space between 3rd & 4th down blocks */
  #third-fourth { gap: 32px }

  /* Mobile polish */
  html, body, .wrap, .page { overflow-x: hidden }
  @media (max-width: 420px) {
    :root { --card-h: 460px }
    .track { padding-inline: 0 }
    .slide { flex: 0 0 100%; max-width: 100% }
    .head { padding: 8px 10px; gap: 12px }
    .badge { font-size: 12px; gap: 6px }
    .meta { font-size: 11px; padding: 8px 10px }
  }

  /* Micro layout for very small screens: stack Away / Score / Home */
  @media (max-width: 420px) {
    .matchup {
      grid-template-columns: 1fr;
      grid-template-areas:
        "away"
        "score"
        "home";
      row-gap: 8px;
    }
    .team.left  { grid-area: away; justify-self: stretch; grid-template-columns: 48px 1fr; }
    .team.right { grid-area: home; justify-self: stretch; grid-template-columns: 1fr 48px; }
    .logo { width: 48px; height: 48px; }
    .name .mascot { font-size: clamp(16px, 6vw, 19px); }
    .name .city   { font-size: clamp(12px, 4.4vw, 13px); }
    .score .num { font-size: clamp(34px, 12vw, 48px); }
  }

</style>

<!-- Mobile-fit hotfix (proven) -->
<style id="mobile-fit-hotfix">
  @media (max-width: 420px) {
    :root { --card-h: 78dvh; --head-h: 52px; --meta-h: 40px; --content-h: calc(var(--card-h) - var(--head-h) - var(--meta-h)) }
    .track { padding-inline: 0 }
    .slide { flex: 0 0 100%; max-width: 100% }
    #kpis-1 .kpi-grid, #drives .split2 { grid-template-columns: 1fr }
  }
  svg.chart, .chart { max-width: 100%; height: 100%; display: block }
  svg:not(.chart) { height: auto; max-width: 100% }
  .pad { overflow: auto; padding-bottom: calc(16px + env(safe-area-inset-bottom)) }
  img { max-width: 100%; height: auto }
</style>

<style id="firstdowns-spacing-overrides">
  /* Extra readability for first-downs sections */
  .firstdowns{gap:32px;}               /* space BETWEEN sections */
  #firstdowns .metric { gap: 16px; }    /* space BETWEEN label and each bar row */
  #firstdowns .teamrow { margin: 0; }   /* no extra margin inside rows */
</style>

</head>
<body>
  <div class="wrap">
    <section class="banner" role="banner" aria-label="Game banner">
      <div class="veil">
        <div class="topline">Week 1 • September 8, 2024</div>
        <div class="matchup">
          <div class="team left">
            <div class="logo"><img src="https://a.espncdn.com/i/teamlogos/nfl/500/ind.png" decoding="async" loading="lazy" alt="Indianapolis Colts logo"></div>
            <div class="name">
              <span class="city">Indianapolis Colts</span>
              <span class="mascot"></span>
            </div>
          </div>
          <div class="score" aria-label="Final score">
            <div class="num">16</div>
            <div class="dash">–</div>
            <div class="num">24</div>
          </div>
          <div class="team right">
            <div class="name">
              <span class="city">Baltimore Ravens</span>
              <span class="mascot"></span>
            </div>
            <div class="logo"><img src="https://a.espncdn.com/i/teamlogos/nfl/500/bal.png" decoding="async" loading="lazy" alt="Baltimore Ravens logo"></div>
          </div>
        </div>
        <div class="cta">
          <a id="premium-cta" href="https://premium.pff.com/nfl/games/2024/1" target="_blank" rel="noopener">View in Premium Stats</a>
        </div>
      </div>
      <img class="powered" src="https://media.pff.com/2025/07/PFF_PoweredBy_White.png" alt="Powered by PFF">
    </section>
  </div>

  <div class="page">
    <section id="game-overview">
      <h3 style="margin:0 0 12px; font-size:22px; font-weight:800">Game overview</h3>
      <div class="track">

        <div class="slide">
          <div class="card">
            <div class="head" data-head></div>
            <div class="content"><svg class="chart" id="score-timeline" aria-label="Score timeline"></svg></div>
            <div class="meta"><span>Score timeline</span><span>swipe ▶</span></div>
          </div>
        </div>

        <div class="slide">
          <div class="card">
            <div class="head" data-head></div>
            <div class="content"><div class="pad" id="kpis-1"></div></div>
            <div class="meta"><span>Plays, yards, efficiency</span><span>swipe ▶</span></div>
          </div>
        </div>

        <div class="slide">
          <div class="card">
            <div class="head" data-head></div>
            <div class="content"><div class="pad firstdowns" id="firstdowns"></div></div>
            <div class="meta"><span>First downs breakdown</span><span>swipe ▶</span></div>
          </div>
        </div>

        <div class="slide">
          <div class="card">
            <div class="head" data-head></div>
            <div class="content"><div class="pad" id="third-fourth"></div></div>
            <div class="meta"><span>3rd & 4th down efficiency</span><span>swipe ▶</span></div>
          </div>
        </div>

        <div class="slide">
          <div class="card">
            <div class="head" data-head></div>
            <div class="content"><div class="pad" id="drives"></div></div>
            <div class="meta"><span>Drives summary</span><span>swipe ▶</span></div>
          </div>
        </div>

        <div class="slide">
          <div class="card">
            <div class="head" data-head></div>
            <div class="content"><div class="pad" id="redzone"></div></div>
            <div class="meta"><span>Red zone summary</span><span>swipe ▶</span></div>
          </div>
        </div>

        <div class="slide">
          <div class="card">
            <div class="head" data-head></div>
            <div class="content"><div class="pad" id="scoring"></div></div>
            <div class="meta"><span>Scoring summary</span><span>swipe ▶</span></div>
          </div>
        </div>

      </div>
    </section>
  </div>

<script id="game-data" type="application/json">{"meta":{"week":1,"date":"September 8, 2024","season":2024,"premium_url":"https://premium.pff.com/nfl/games/2024/1"},"away":{"name":"Indianapolis Colts","city":"Indianapolis Colts","mascot":"","q":[6,3,7,0],"cum":[6,9,16,16],"color":"#002C5F","color2":"#a5acaf","logo":"https://a.espncdn.com/i/teamlogos/nfl/500/ind.png","score":16},"home":{"name":"Baltimore Ravens","city":"Baltimore Ravens","mascot":"","q":[14,7,0,3],"cum":[14,21,21,24],"color":"#241773","color2":"#9E7C0C","logo":"https://a.espncdn.com/i/teamlogos/nfl/500/bal.png","score":24},"quarters":["1Q","2Q","3Q","4Q"],"metrics":{"Total points":{"away":"16","home":"24"},"Total offensive plays":{"away":"78","home":"60"},"Average EPA per play":{"away":"-0.164","home":"-0.149"},"Total net yards":{"away":"333","home":"213"},"Avg yards per play":{"away":"4.3","home":"3.5"},"Total first downs":{"away":"19","home":"15"},"Rushing first downs":{"away":"6","home":"10"},"Passing first downs":{"away":"13","home":"3"},"Penalty first downs":{"away":"0","home":"2"},"3rd down efficiency":{"away":"32%","home":"36%"},"4th down efficiency":{"away":"8%","home":"13%"},"Possessions":{"away":"13","home":"13"},"Avg plays per drive":{"away":"6.7","home":"5.4"},"Avg yards per drive":{"away":"23.8","home":"15.2"},"Avg points per drive":{"away":"1.1","home":"1.3"},"Red zone posessions":{"away":"3","home":"2"},"Red zone plays":{"away":"9","home":"6"},"Red zone TDs":{"away":"1","home":"1"},"Red zone FGs":{"away":"1","home":"0"},"RZ scoring efficiency":{"away":"67%","home":"50%"},"Goal-to-go possessions":{"away":"1","home":"1"},"Goal-to-go plays":{"away":"3","home":"1"},"Goal-to-go TDs":{"away":"1","home":"1"},"Goal-to-go FGs":{"away":"0","home":"0"},"GTG scoring efficiency":{"away":"100%","home":"100%"},"Total turnovers":{"away":"1","home":"2"},"INTs (thrown)":{"away":"1","home":"2"},"Dropped INTs (thrown)":{"away":"1","home":"0"},"INT return yards":{"away":"2","home":"0"},"Fumbles":{"away":"0","home":"1"},"Fumbles lost":{"away":"0","home":"0"},"Turnover on downs":{"away":"1","home":"0"},"Penalties assessed":{"away":"9","home":"7"},"Penalties assessed - yards lost":{"away":"107","home":"43"},"Penalties declined / offset":{"away":"0","home":"1"},"Total touchdowns":{"away":"1","home":"2"},"Rushing touchdowns":{"away":"1","home":"2"},"Passing touchdowns":{"away":"0","home":"0"},"Return touchdowns":{"away":"0","home":"1"},"Defensive touchdowns":{"away":"0","home":"0"},"Safeties surrendered":{"away":"0","home":"0"},"2-point conversion attempts":{"away":"0","home":"0"},"2-point conversion successes":{"away":"0","home":"0"},"Challenges by team":{"away":"0","home":"1"},"Successful Challenges":{"away":"0","home":"0"},"Trick plays":{"away":"0","home":"0"},"Red zone possessions":{"away":"3","home":"2"}},"pr":{"Total rushing plays":{"away":"28","home":"42"},"Avg EPA per rushing play":{"away":"0.138","home":"0.019"},"Net yards rushing":{"away":"126","home":"177"},"Avg net yards per rush":{"away":"4.5","home":"4.2"},"Avg yards before contact":{"away":"2.1","home":"1.5"},"Avg yards after contact":{"away":"2.4","home":"2.7"},"Explosive runs (10+)":{"away":"3","home":"4"},"Yards on expl. runs":{"away":"48","home":"75"},"TFL on rushing attempts":{"away":"0","home":"1"},"Yards lost on TFLs":{"away":"0","home":"-1"},"Scrambles":{"away":"3","home":"2"},"Scramble Yards":{"away":"30","home":"10"},"Designed runs by QB":{"away":"1","home":"4"},"Designed runs by QB - yards":{"away":"4","home":"5"},"MTs forced on run plays":{"away":"0","home":"9"},"Total passing plays":{"away":"50","home":"18"},"Avg EPA per passing play":{"away":"-0.334","home":"-0.543"},"Gross passing yards":{"away":"257","home":"59"},"Avg (gross) yds per att.":{"away":"5.3","home":"3.7"},"Avg (gross) yds per comp.":{"away":"10.7","home":"11.8"},"Pass Attempts":{"away":"48","home":"16"},"Pass Completions":{"away":"24","home":"5"},"Completion %":{"away":"50%","home":"31%"},"Adj. completion %":{"away":"66%","home":"43%"},"Targeted passes":{"away":"44","home":"14"},"Dropped passes":{"away":"5","home":"1"},"Batted passes":{"away":"3","home":"2"},"Hit as thrown":{"away":"0","home":"0"},"Throwaways":{"away":"1","home":"0"},"Spikes":{"away":"0","home":"0"},"Passes broken up":{"away":"7","home":"1"},"Avg depth of target":{"away":"9.4","home":"13.3"},"Air yards":{"away":"177","home":"51"},"Avg air yds per comp.":{"away":"7.4","home":"10.2"},"Yards after the catch":{"away":"80","home":"8"},"Avg YAC per comp.":{"away":"3.3","home":"1.6"},"Yds lost on drops":{"away":"-2","home":"-2"},"Explosive passes (15+)":{"away":"7","home":"1"},"Yards on expl. passes":{"away":"145","home":"30"},"Deep attempts (20+)":{"away":"5","home":"4"},"Deep completions":{"away":"1","home":"1"},"Yards on deep comps":{"away":"24","home":"30"},"Total pressures allowed":{"away":"28","home":"8"},"Sacks allowed":{"away":"2","home":"2"},"Yards lost on sacks":{"away":"17","home":"16"},"Hits allowed":{"away":"4","home":"1"},"Hurries allowed":{"away":"15","home":"5"},"Unbl. pressures allowed":{"away":"2","home":"2"},"MTs forced on pass plays":{"away":"2","home":"0"}}}</script>
<script>
// CTA ripple
(function(){
  var btn = document.getElementById("premium-cta");
  if (!btn) return;
  btn.addEventListener("pointerdown", function(e){
    var rect = btn.getBoundingClientRect();
    var x = ((e.clientX - rect.left) / rect.width) * 100;
    var y = ((e.clientY - rect.top) / rect.height) * 100;
    btn.style.setProperty("--x", x + "%");
    btn.style.setProperty("--y", y + "%");
  });
})();

(function(){
  function parseDATA(){try{return JSON.parse(document.getElementById("game-data").textContent)}catch(e){return {away:{},home:{},metrics:{},quarters:[]}}}
  var DATA = parseDATA(), AWAY = DATA.away||{}, HOME = DATA.home||{};

  function setHeads(){
    var heads = document.querySelectorAll("[data-head]");
    for(var i=0;i<heads.length;i++){
      heads[i].innerHTML = "<div class=\"badge\"><img src=\"" + (AWAY.logo||"") + "\" alt=\"\"><span>" + (AWAY.name||"Away") + "</span></div>"
                          + "<span class=\"sep\">•</span>"
                          + "<div class=\"badge\"><img src=\"" + (HOME.logo||"") + "\" alt=\"\"><span>" + (HOME.name||"Home") + "</span></div>";
    }
  }
  setHeads();

  // Score timeline
  (function(){
    var svg = document.getElementById("score-timeline");
    if (!svg) return;
    function draw(){
      while(svg.firstChild) svg.removeChild(svg.firstChild);
      var rect = svg.getBoundingClientRect();
      var W=rect.width||320, H=rect.height||360, P=28, PR=48;
      svg.setAttribute("viewBox","0 0 "+W+" "+H);
      var x = function(t){ return P + t*((W-P-PR)/3) };
      var maxScore = Math.max((AWAY.cum||[0,0,0,0])[3]||0, (HOME.cum||[0,0,0,0])[3]||0) || 1;
      var y = function(s){ return H - P - (s/maxScore)*(H-2*P) };
      function mk(tag){ return document.createElementNS("http://www.w3.org/2000/svg", tag) }
      var ticks = [0, Math.round(maxScore/2), maxScore];
      for(var i=0;i<ticks.length;i++){
        var yy = y(ticks[i]);
        var hline = mk("line"); hline.setAttribute("x1", P); hline.setAttribute("y1", yy);
        hline.setAttribute("x2", W-PR); hline.setAttribute("y2", yy);
        hline.setAttribute("stroke","rgba(255,255,255,.12)"); hline.setAttribute("stroke-width","1"); svg.appendChild(hline);
        var ty = mk("text"); ty.setAttribute("x", P-8); ty.setAttribute("y", yy+4);
        ty.setAttribute("fill","rgba(255,255,255,.85)"); ty.setAttribute("font-size","12"); ty.setAttribute("text-anchor","end");
        ty.textContent = ticks[i]; svg.appendChild(ty);
      }
      var ylabel = mk("text"); ylabel.setAttribute("x", 12); ylabel.setAttribute("y", P-8);
      ylabel.setAttribute("fill","rgba(255,255,255,.85)"); ylabel.setAttribute("font-size","12"); ylabel.textContent = "Score"; svg.appendChild(ylabel);
      for(var iq=0;iq<=4;iq++){
        var vx = P + iq*((W-P-PR)/3);
        var vline = mk("line"); vline.setAttribute("x1", vx); vline.setAttribute("y1", P);
        vline.setAttribute("x2", vx); vline.setAttribute("y2", H-P);
        vline.setAttribute("stroke","rgba(255,255,255,.08)"); vline.setAttribute("stroke-width","1"); svg.appendChild(vline);
        if(iq<4){
          var txt = mk("text"); txt.setAttribute("x", x(iq)); txt.setAttribute("y", H-P+14);
          txt.setAttribute("fill","rgba(255,255,255,.85)"); txt.setAttribute("font-size","12"); txt.setAttribute("text-anchor","middle");
          txt.textContent = (DATA.quarters||["1Q","2Q","3Q","4Q"])[iq]; svg.appendChild(txt);
        }
      }
      function stepPath(values){
        var d = "M " + x(0) + " " + y(values[0]);
        for(var i=1;i<values.length;i++){ d += " H " + x(i) + " V " + y(values[i]) }
        return d;
      }
      var pathA = mk("path"); pathA.setAttribute("d", stepPath(AWAY.cum||[0,0,0,0])); pathA.setAttribute("fill","none"); pathA.setAttribute("stroke", AWAY.color||"#aaa"); pathA.setAttribute("stroke-width","3"); svg.appendChild(pathA);
      var pathH = mk("path"); pathH.setAttribute("d", stepPath(HOME.cum||[0,0,0,0])); pathH.setAttribute("fill","none"); pathH.setAttribute("stroke", HOME.color||"#ddd"); pathH.setAttribute("stroke-width","3"); svg.appendChild(pathH);
      function cap(xp, yp, txt, logoUrl){
        var g = mk("g");
        var tw = Math.max(48, txt.length*7 + (logoUrl?28:12));
        xp = Math.min(xp, W - PR - tw);
        var bg = mk("rect"); bg.setAttribute("x", xp); bg.setAttribute("y", Math.max(P, yp-13)); bg.setAttribute("rx","6"); bg.setAttribute("ry","6");
        bg.setAttribute("width", tw); bg.setAttribute("height","20");
        bg.setAttribute("fill","rgba(0,0,0,.45)"); g.appendChild(bg);
        var t = mk("text"); t.setAttribute("x", xp+(logoUrl?26:8)); t.setAttribute("y", Math.max(P, yp-13)+16); t.setAttribute("fill","#fff"); t.setAttribute("font-size","12"); t.textContent = txt; g.appendChild(t);
        if(logoUrl){ var ico = mk("image"); ico.setAttributeNS("http://www.w3.org/1999/xlink","href", logoUrl); ico.setAttribute("x", xp+6); ico.setAttribute("y", Math.max(P, yp-11)); ico.setAttribute("width","14"); ico.setAttribute("height","14"); g.appendChild(ico) }
        return g;
      }
      svg.appendChild(cap(x(3)+6, y((AWAY.cum||[0,0,0,0])[3]||0), (AWAY.name||"Away") + " " + ((AWAY.cum||[0,0,0,0])[3]||0), AWAY.logo));
      svg.appendChild(cap(x(3)+6, y((HOME.cum||[0,0,0,0])[3]||0)+16, (HOME.name||"Home") + " " + ((HOME.cum||[0,0,0,0])[3]||0), HOME.logo));
    }
    draw();
    window.addEventListener("resize", function(){ clearTimeout(svg._rt); svg._rt=setTimeout(draw,150) });
  })();

  function metric(lbl, side){
    var m = DATA.metrics[lbl]
          || DATA.metrics[(lbl||"").replace && (lbl||"").replace("possessions","posessions")]
          || DATA.metrics[(lbl||"").replace && (lbl||"").replace("posessions","possessions")];
    if(!m) return "—";
    var v = m[side];
    return (v===null || v===undefined || v==="") ? "—" : v;
  }
  function metricAny(lbls, side){
    for(var i=0;i<lbls.length;i++){ var v = metric(lbls[i], side); if(v !== "—") return v }
    return "—";
  }

  (function(){
    var el = document.getElementById("kpis-1");
    if (!el) return;
    function card(lbl){
      var a = metric(lbl,"away"), h = metric(lbl,"home");
      return "        <div class=\"kpi\">          <div class=\"label\">" + lbl + "</div>          <div class=\"rowv\">            <div class=\"v\"><img src=\"" + (AWAY.logo||"") + "\" alt=\"\"><span class=\"n\">" + a + "</span></div>            <div class=\"v\"><img src=\"" + (HOME.logo||"") + "\" alt=\"\"><span class=\"n\">" + h + "</span></div>          </div>        </div>";
    }
    el.innerHTML = "<div class=\"kpi-grid\">" + ["Total offensive plays","Total net yards","Avg yards per play","Average EPA per play"].map(card).join("") + "</div>";
  })();

  (function(){
    var el = document.getElementById("firstdowns");
    if (!el) return;
    function sums(){
      var a = parseFloat(metric("Rushing first downs","away"))||0,
          b = parseFloat(metric("Passing first downs","away"))||0,
          c = parseFloat(metric("Penalty first downs","away"))||0;
      var d = parseFloat(metric("Rushing first downs","home"))||0,
          e = parseFloat(metric("Passing first downs","home"))||0,
          f = parseFloat(metric("Penalty first downs","home"))||0;
      return {sa:a+b+c, sh:d+e+f, a:{rush:a,pass:b,pen:c}, h:{rush:d,pass:e,pen:f}};
    }
    var S = sums();
    function block(label, a, h, sa, sh){
      var wa = sa>0? (a/sa*100) : 0;
      var wh = sh>0? (h/sh*100) : 0;
      return "        <div class=\"metric\">          <div class=\"lbl\">" + label + " (share of team 1st downs)</div>          <div class=\"teamrow\"><div class=\"teamname\">" + (AWAY.name||"Away") + "</div><div class=\"bar\"><span class=\"fill\" style=\"width:" + wa + "%\"></span></div><div class=\"val\">" + a + "</div></div>          <div class=\"teamrow\"><div class=\"teamname\">" + (HOME.name||"Home") + "</div><div class=\"bar\"><span class=\"fill\" style=\"width:" + wh + "%\"></span></div><div class=\"val\">" + h + "</div></div>        </div>";
    }
    el.innerHTML = block("Rushing first downs", S.a.rush, S.h.rush, S.sa, S.sh)
                 + block("Passing first downs", S.a.pass, S.h.pass, S.sa, S.sh)
                 + block("Penalty first downs", S.a.pen, S.h.pen, S.sa, S.sh);
  })();

  (function(){
    var el = document.getElementById("third-fourth");
    if (!el) return;
    function row(lbl){
      var a = String(metric(lbl,"away")), h = String(metric(lbl,"home"));
      var ap = (function(){ var n=parseFloat((a||"").replace("%","")); return isNaN(n)?0:n })();
      var hp = (function(){ var n=parseFloat((h||"").replace("%","")); return isNaN(n)?0:n })();
      return "        <div class=\"metric\">          <div class=\"lbl\">" + lbl.replace(" efficiency","") + "</div>          <div class=\"teamrow\"><div class=\"teamname\">" + (AWAY.name||"Away") + "</div><div class=\"bar\"><span class=\"fill\" style=\"width:" + ap + "%\"></span></div><div class=\"val\">" + a + "</div></div>          <div class=\"teamrow\"><div class=\"teamname\">" + (HOME.name||"Home") + "</div><div class=\"bar\"><span class=\"fill\" style=\"width:" + hp + "%\"></span></div><div class=\"val\">" + h + "</div></div>        </div>";
    }
    el.innerHTML = row("3rd down efficiency") + row("4th down efficiency");
  })();

  (function(){
    var el = document.getElementById("drives");
    if (!el) return;
    var fields = ["Possessions","Avg plays per drive","Avg yards per drive","Avg points per drive"];
    el.innerHTML = "<div class=\"split2\">" + fields.map(function(lbl){
      return "        <div class=\"tile\"><h4>" + lbl + "</h4>          <div class=\"rowpair\"><span class=\"tag\"><img src=\"" + (AWAY.logo||"") + "\" alt=\"\">" + (AWAY.name||"Away") + "</span><span class=\"big\">" + metric(lbl,"away") + "</span></div>          <div class=\"rowpair\"><span class=\"tag\"><img src=\"" + (HOME.logo||"") + "\" alt=\"\">" + (HOME.name||"Home") + "</span><span class=\"big\">" + metric(lbl,"home") + "</span></div>        </div>";
    }).join("") + "</div>";
  })();

  (function(){
    var el = document.getElementById("redzone");
    if (!el) return;
    var groups = [
      {label:"Red zone possessions", keys:["Red zone possessions","Red zone posessions"]},
      {label:"Red zone plays", keys:["Red zone plays"]},
      {label:"Red zone TDs", keys:["Red zone TDs"]},
      {label:"Red zone FGs", keys:["Red zone FGs"]},
      {label:"RZ scoring efficiency", keys:["RZ scoring efficiency"]}
    ];
    el.innerHTML = "<div class=\"split2\">" + groups.map(function(g){
      return "        <div class=\"tile\"><h4>" + g.label + "</h4>          <div class=\"rowpair\"><span class=\"tag\"><img src=\"" + (AWAY.logo||"") + "\" alt=\"\">" + (AWAY.name||"Away") + "</span><span class=\"big\">" + (DATA.metrics[g.keys[0]]? (DATA.metrics[g.keys[0]].away||"—") : (DATA.metrics[g.keys[1]]? (DATA.metrics[g.keys[1]].away||"—") : "—")) + "</span></div>          <div class=\"rowpair\"><span class=\"tag\"><img src=\"" + (HOME.logo||"") + "\" alt=\"\">" + (HOME.name||"Home") + "</span><span class=\"big\">" + (DATA.metrics[g.keys[0]]? (DATA.metrics[g.keys[0]].home||"—") : (DATA.metrics[g.keys[1]]? (DATA.metrics[g.keys[1]].home||"—") : "—")) + "</span></div>        </div>";
    }).join("") + "</div>";
  })();

  (function(){
    var el = document.getElementById("scoring");
    if (!el) return;
    var fields = ["Total touchdowns","Rushing touchdowns","Passing touchdowns","Return touchdowns","Defensive touchdowns"];
    el.innerHTML = "<div class=\"split2\">" + fields.map(function(lbl){
      return "        <div class=\"tile\"><h4>" + lbl + "</h4>          <div class=\"rowpair\"><span class=\"tag\"><img src=\"" + (AWAY.logo||"") + "\" alt=\"\">" + (AWAY.name||"Away") + "</span><span class=\"big\">" + metric(lbl,"away") + "</span></div>          <div class=\"rowpair\"><span class=\"tag\"><img src=\"" + (HOME.logo||"") + "\" alt=\"\">" + (HOME.name||"Home") + "</span><span class=\"big\">" + metric(lbl,"home") + "</span></div>        </div>";
    }).join("") + "</div>";
  })();
})();
</script>

<!-- Dynamic card height tied to innerHeight (quote-safe) -->
<script>
  (function () {
    function setCardH() {
      var h = Math.max(420, Math.min(560, Math.floor(window.innerHeight * 0.78)));
      document.documentElement.style.setProperty("--card-h", h + "px");
    }
    setCardH();
    window.addEventListener("resize", setCardH, { passive: true });
  })();
</script>

  <div class="page">
    <section id="rushing-report">
      <h3 style="margin:0 0 12px; font-size:22px; font-weight:800">Team Rushing Reports</h3>
      <div class="track">

        <!-- EPA per rushing play (percentile micro bars) -->
        <div class="slide">
          <div class="card">
            <div class="head" data-rr-head></div>
            <div class="content">
              <style>
                #rushing-report .rr-bigpair{height:100%;display:grid;grid-template-columns:1fr 1fr;gap:16px;align-items:center;justify-items:center;padding:16px}
                #rushing-report .rr-bigtile{width:100%;height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:12px;background:linear-gradient(180deg, rgba(255,255,255,.035), rgba(255,255,255,.02)); border:1px solid rgba(255,255,255,.08); border-radius:14px; padding:16px}
                #rushing-report .rr-bigteam{display:flex;align-items:center;gap:8px;font-size:13px;font-weight:800;color:#fff}
                #rushing-report .rr-bigteam img{width:18px;height:18px;border-radius:4px;background:#0a0f18;padding:2px}
                #rushing-report .rr-bignum{font-size:56px;font-weight:800;line-height:1;color:#fff}
                #rushing-report .rr-micro{position:relative;width:100%;height:8px;border-radius:4px;background:rgba(255,255,255,.14);overflow:hidden}
                #rushing-report .rr-micro span{display:block;height:100%;width:0%;background:rgba(255,255,255,.92)}
                #rushing-report .rr-pct{font-size:12px;font-weight:800;color:#fff;opacity:.9}
                #rushing-report .rr-split2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
                #rushing-report .rr-tile{background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:12px}
                #rushing-report .rr-tile h4{margin:0 0 6px;font-size:12px;color:rgba(255,255,255,.75)}
                #rushing-report .rr-row{display:flex;justify-content:space-between;align-items:center;margin:6px 0}
                #rushing-report .rr-tag{display:flex;align-items:center;gap:6px;font-weight:800;font-size:13px;color:#fff}
                #rushing-report .rr-tag img{width:16px;height:16px;object-fit:contain;border-radius:3px;background:#0a0f18;padding:1px}
                #rushing-report .rr-big{font-size:20px;font-weight:800;color:#fff}
                #rushing-report .rr-stack{display:grid;grid-template-columns:1fr;gap:10px}
                @media (max-width:420px) {
                  #rushing-report .rr-bigpair{grid-template-columns:1fr; gap:14px}
                  #rushing-report .rr-bignum{font-size:60px}
                }
              </style>
              <div class="rr-bigpair">
                <div class="rr-bigtile">
                  <div class="rr-bigteam"><img id="rr-a-logo" alt=""><span id="rr-a-name">Away</span></div>
                  <div class="rr-bignum" id="rr-a-val">+0.00</div>
                  <div class="rr-micro"><span id="rr-a-bar"></span></div>
                  <div class="rr-pct" id="rr-a-pct">0th percentile</div>
                  <div class="rr-pct" style="opacity:.65">EPA per rushing play (vs last season)</div>
                </div>
                <div class="rr-bigtile">
                  <div class="rr-bigteam"><img id="rr-h-logo" alt=""><span id="rr-h-name">Home</span></div>
                  <div class="rr-bignum" id="rr-h-val">+0.00</div>
                  <div class="rr-micro"><span id="rr-h-bar"></span></div>
                  <div class="rr-pct" id="rr-h-pct">0th percentile</div>
                  <div class="rr-pct" style="opacity:.65">EPA per rushing play (vs last season)</div>
                </div>
              </div>
            </div>
            <div class="meta"><span>Avg EPA per rushing play</span><span>swipe ▶</span></div>
          </div>
        </div>

        <!-- Rushing summary -->
        <div class="slide">
          <div class="card">
            <div class="head" data-rr-head></div>
            <div class="content"><div class="pad"><div class="rr-split2" id="rr-summary"></div></div></div>
            <div class="meta"><span>Rushing report</span><span>swipe ▶</span></div>
          </div>
        </div>

        <!-- Explosive & elusivity -->
        <div class="slide">
          <div class="card">
            <div class="head" data-rr-head></div>
            <div class="content"><div class="pad"><div class="rr-split2" id="rr-explosive"></div></div></div>
            <div class="meta"><span>Explosive runs &amp; elusivity</span><span>swipe ▶</span></div>
          </div>
        </div>

        <!-- QB runs (stacked) -->
        <div class="slide">
          <div class="card">
            <div class="head" data-rr-head></div>
            <div class="content"><div class="pad"><div class="rr-stack" id="rr-qb"></div></div></div>
            <div class="meta"><span>Quarterback runs</span><span>swipe ▶</span></div>
          </div>
        </div>

      </div>
    </section>
  </div>

<!-- ECDF percentiles lookup (0..100 thresholds) -->
<script id="rr-percentiles" type="application/json">{"percentiles":{"epa_rush_per_play":[]}}</script>

<script>
  (function(){
    function G(){ try { return JSON.parse(document.getElementById("game-data").textContent) } catch(e) { return null } }
    var D = G() || {}, A = (D.away||{}), H = (D.home||{}), PR = (D.pr||{});

    document.querySelectorAll("#rushing-report [data-rr-head]").forEach(function(h){
      h.innerHTML = "<div class=\"badge\"><img src=\"" + (A.logo||"") + "\" alt=\"\"><span>" + (A.name||"Away") + "</span></div>"
                  + "<span class=\"sep\">•</span>"
                  + "<div class=\"badge\"><img src=\"" + (H.logo||"") + "\" alt=\"\"><span>" + (H.name||"Home") + "</span></div>";
    });

    function J(id){ try { return JSON.parse(document.getElementById(id).textContent) } catch(e) { return null } }
    var P = J("rr-percentiles") || {percentiles:{}};
    var LOOK = ((P||{}).percentiles||{}).epa_rush_per_play || [];

    // Fallback quartiles (last season)
    var Q25 = -0.24775, Q50 = -0.089, Q75 = 0.05275;
    function pctFromQuartiles(v){
      var vN = parseFloat(v); if(isNaN(vN)) return 0;
      var minV = Q25 - (Q50 - Q25), maxV = Q75 + (Q75 - Q50);
      if (vN <= minV) return 0;
      if (vN >= maxV) return 100;
      if (vN <= Q25) return ( (vN - minV) / (Q25 - minV) ) * 25;
      if (vN <= Q50) return 25 + ( (vN - Q25) / (Q50 - Q25) ) * 25;
      if (vN <= Q75) return 50 + ( (vN - Q50) / (Q75 - Q50) ) * 25;
      return 75 + ( (vN - Q75) / (maxV - Q75) ) * 25;
    }
    function makeECDF(lookup){
      if(!lookup || !lookup.length) return function(v){ return Math.round(pctFromQuartiles(v)) };
      var L = lookup;
      return function(v){
        var x = parseFloat(v); if(isNaN(x)) return 0;
        var lo=0, hi=L.length-1, ans=0;
        while(lo<=hi){ var mid=(lo+hi)>>1; if(x >= L[mid]){ ans=mid; lo=mid+1; } else hi=mid-1; }
        return ans;
      };
    }
    function ordinal(n){
      n = Math.round(n);
      var k = n % 100, j = n % 10;
      if (k >= 11 && k <= 13) return n + "th";
      if (j === 1) return n + "st";
      if (j === 2) return n + "nd";
      if (j === 3) return n + "rd";
      return n + "th";
    }
    var ecdfRush = makeECDF(LOOK);

    function num(x){ var n=parseFloat(x); return isNaN(n)?0:n }
    function fmt(v){ return (v>=0?"+":"") + v.toFixed(2) }

    var aEPA = num((PR["Avg EPA per rushing play"]||{}).away),
        hEPA = num((PR["Avg EPA per rushing play"]||{}).home);
    var aP = ecdfRush(aEPA), hP = ecdfRush(hEPA);

    document.getElementById("rr-a-name").textContent = A.name||"Away";
    document.getElementById("rr-h-name").textContent = H.name||"Home";
    document.getElementById("rr-a-logo").src = A.logo||"";
    document.getElementById("rr-h-logo").src = H.logo||"";
    document.getElementById("rr-a-val").textContent  = fmt(aEPA);
    document.getElementById("rr-h-val").textContent  = fmt(hEPA);
    document.getElementById("rr-a-bar").style.width  = aP + "%";
    document.getElementById("rr-h-bar").style.width  = hP + "%";
    (document.getElementById("rr-a-pct")||{}).textContent = ordinal(aP) + " percentile";
    (document.getElementById("rr-h-pct")||{}).textContent = ordinal(hP) + " percentile";

    function tile(label, key){
      var aw = (PR[key]||{}).away || "—", ho = (PR[key]||{}).home || "—";
      return "<div class=\"rr-tile\"><h4>" + label + "</h4>"
           + "<div class=\"rr-row\"><span class=\"rr-tag\"><img src=\"" + (A.logo||"") + "\">" + (A.name||"Away") + "</span><span class=\"rr-big\">" + aw + "</span></div>"
           + "<div class=\"rr-row\"><span class=\"rr-tag\"><img src=\"" + (H.logo||"") + "\">" + (H.name||"Home") + "</span><span class=\"rr-big\">" + ho + "</span></div>"
           + "</div>";
    }

    document.getElementById("rr-summary").innerHTML =
        tile("Total rushing plays","Total rushing plays")
      + tile("Net yards rushing","Net yards rushing")
      + tile("Avg net yards per rush","Avg net yards per rush")
      + tile("Avg yards before contact","Avg yards before contact")
      + tile("Avg yards after contact","Avg yards after contact");

    document.getElementById("rr-explosive").innerHTML =
        tile("Explosive runs (10+)","Explosive runs (10+)")
      + tile("Yards on expl. runs","Yards on expl. runs")
      + tile("TFL on rushing attempts","TFL on rushing attempts")
      + tile("Yards lost on TFLs","Yards lost on TFLs")
      + tile("MTs forced on run plays","MTs forced on run plays");

    document.getElementById("rr-qb").innerHTML =
        tile("Scrambles","Scrambles")
      + tile("Scramble Yards","Scramble Yards")
      + tile("Designed runs by QB","Designed runs by QB")
      + tile("Designed runs by QB - yards","Designed runs by QB - yards");
  })();
</script>

  <div class="page">
    <section id="passing-report">
      <h3 style="margin:0 0 12px; font-size:22px; font-weight:800">Team Passing Reports</h3>
      <div class="track">

        <!-- EPA per passing play (percentile micro bars) -->
        <div class="slide">
          <div class="card">
            <div class="head" data-pr-head></div>
            <div class="content">
              <style>
                #passing-report .pr-bigpair{height:100%;display:grid;grid-template-columns:1fr 1fr;gap:16px;align-items:center;justify-items:center;padding:16px}
                #passing-report .pr-bigtile{width:100%;height:100%;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:12px;background:linear-gradient(180deg, rgba(255,255,255,.035), rgba(255,255,255,.02)); border:1px solid rgba(255,255,255,.08); border-radius:14px; padding:16px}
                #passing-report .pr-bigteam{display:flex;align-items:center;gap:8px;font-size:13px;font-weight:800;color:#fff}
                #passing-report .pr-bigteam img{width:18px;height:18px;border-radius:4px;background:#0a0f18;padding:2px}
                #passing-report .pr-bignum{font-size:56px;font-weight:800;line-height:1;color:#fff}
                #passing-report .pr-micro{position:relative;width:100%;height:8px;border-radius:4px;background:rgba(255,255,255,.14);overflow:hidden}
                #passing-report .pr-micro span{display:block;height:100%;width:0%;background:rgba(255,255,255,.92)}
                #passing-report .pr-pct{font-size:12px;font-weight:800;color:#fff;opacity:.9}
                #passing-report .pr-split2{display:grid;grid-template-columns:1fr 1fr;gap:10px}
                #passing-report .pr-tile{background:rgba(255,255,255,.04);border:1px solid rgba(255,255,255,.08);border-radius:12px;padding:12px}
                #passing-report .pr-tile h4{margin:0 0 6px;font-size:12px;color:rgba(255,255,255,.75)}
                #passing-report .pr-row{display:flex;justify-content:space-between;align-items:center;margin:6px 0}
                #passing-report .pr-tag{display:flex;align-items:center;gap:6px;font-weight:800;font-size:13px;color:#fff}
                #passing-report .pr-tag img{width:16px;height:16px;object-fit:contain;border-radius:3px;background:#0a0f18;padding:1px}
                #passing-report .pr-big{font-size:20px;font-weight:800;color:#fff}
                #passing-report .pr-stack{display:grid;grid-template-columns:1fr;gap:10px}
                #passing-report .pr-piepair{height:100%;display:grid;grid-template-columns:1fr 1fr;gap:16px;align-items:center;justify-items:center;padding:16px}
                #passing-report .pr-piechart{width:120px;height:120px;position:relative;border-radius:50%;background:conic-gradient(from 0deg, rgba(255,255,255,.92) 0deg, rgba(255,255,255,.92) var(--completion-deg), rgba(255,255,255,.14) var(--completion-deg), rgba(255,255,255,.14) 360deg);}
                #passing-report .pr-piecenter{position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);background:rgba(7,11,16,.95);border-radius:50%;width:60px;height:60px;display:flex;align-items:center;justify-content:center;font-size:18px;font-weight:800;color:#fff}
                @media (max-width:420px) {
                  #passing-report .pr-bigpair{grid-template-columns:1fr; gap:14px}
                  #passing-report .pr-bignum{font-size:60px}
                  #passing-report .pr-piepair{grid-template-columns:1fr; gap:14px}
                }
              </style>
              <div class="pr-bigpair">
                <div class="pr-bigtile">
                  <div class="pr-bigteam"><img id="pr-a-logo" alt=""><span id="pr-a-name">Away</span></div>
                  <div class="pr-bignum" id="pr-a-val">+0.00</div>
                  <div class="pr-micro"><span id="pr-a-bar"></span></div>
                  <div class="pr-pct" id="pr-a-pct">0th percentile</div>
                  <div class="pr-pct" style="opacity:.65">EPA per passing play (vs last season)</div>
                </div>
                <div class="pr-bigtile">
                  <div class="pr-bigteam"><img id="pr-h-logo" alt=""><span id="pr-h-name">Home</span></div>
                  <div class="pr-bignum" id="pr-h-val">+0.00</div>
                  <div class="pr-micro"><span id="pr-h-bar"></span></div>
                  <div class="pr-pct" id="pr-h-pct">0th percentile</div>
                  <div class="pr-pct" style="opacity:.65">EPA per passing play (vs last season)</div>
                </div>
              </div>
            </div>
            <div class="meta"><span>Avg EPA per passing play</span><span>swipe ▶</span></div>
          </div>
        </div>

        <!-- Passing report -->
        <div class="slide">
          <div class="card">
            <div class="head" data-pr-head></div>
            <div class="content"><div class="pad"><div class="pr-split2" id="pr-summary"></div></div></div>
            <div class="meta"><span>Passing report</span><span>swipe ▶</span></div>
          </div>
        </div>

        <!-- Adjusted completion percentage (pie charts) -->
        <div class="slide">
          <div class="card">
            <div class="head" data-pr-head></div>
            <div class="content">
              <div class="pr-piepair">
                <div class="pr-bigtile">
                  <div class="pr-bigteam"><img id="pr-pie-a-logo" alt=""><span id="pr-pie-a-name">Away</span></div>
                  <div class="pr-piechart" id="pr-pie-a-chart" style="--completion-deg: 0deg">
                    <div class="pr-piecenter" id="pr-pie-a-center">0%</div>
                  </div>
                  <div class="pr-pct" style="opacity:.65">Adjusted completion %</div>
                </div>
                <div class="pr-bigtile">
                  <div class="pr-bigteam"><img id="pr-pie-h-logo" alt=""><span id="pr-pie-h-name">Home</span></div>
                  <div class="pr-piechart" id="pr-pie-h-chart" style="--completion-deg: 0deg">
                    <div class="pr-piecenter" id="pr-pie-h-center">0%</div>
                  </div>
                  <div class="pr-pct" style="opacity:.65">Adjusted completion %</div>
                </div>
              </div>
            </div>
            <div class="meta"><span>Adjusted completion percentage</span><span>swipe ▶</span></div>
          </div>
        </div>

        <!-- Pass results -->
        <div class="slide">
          <div class="card">
            <div class="head" data-pr-head></div>
            <div class="content"><div class="pad"><div class="pr-split2" id="pr-results"></div></div></div>
            <div class="meta"><span>Pass results</span><span>swipe ▶</span></div>
          </div>
        </div>

        <!-- Air yards and aDOT -->
        <div class="slide">
          <div class="card">
            <div class="head" data-pr-head></div>
            <div class="content"><div class="pad"><div class="pr-split2" id="pr-airyards"></div></div></div>
            <div class="meta"><span>Air yards and aDOT</span><span>swipe ▶</span></div>
          </div>
        </div>

        <!-- Deep passing & explosive plays -->
        <div class="slide">
          <div class="card">
            <div class="head" data-pr-head></div>
            <div class="content"><div class="pad"><div class="pr-split2" id="pr-deep"></div></div></div>
            <div class="meta"><span>Deep passing &amp; explosive plays</span><span>swipe ▶</span></div>
          </div>
        </div>

        <!-- Pass protection -->
        <div class="slide">
          <div class="card">
            <div class="head" data-pr-head></div>
            <div class="content"><div class="pad"><div class="pr-split2" id="pr-protection"></div></div></div>
            <div class="meta"><span>Pass protection</span><span>swipe ▶</span></div>
          </div>
        </div>

      </div>
    </section>
  </div>

<!-- ECDF percentiles lookup for passing (0..100 thresholds) -->
<script id="pr-percentiles" type="application/json">{"percentiles":{"epa_pass_per_play":[]}}</script>

<script>
  (function(){
    function G(){ try { return JSON.parse(document.getElementById("game-data").textContent) } catch(e) { return null } }
    var D = G() || {}, A = (D.away||{}), H = (D.home||{}), PR = (D.pr||{});

    document.querySelectorAll("#passing-report [data-pr-head]").forEach(function(h){
      h.innerHTML = "<div class=\"badge\"><img src=\"" + (A.logo||"") + "\" alt=\"\"><span>" + (A.name||"Away") + "</span></div>"
                  + "<span class=\"sep\">•</span>"
                  + "<div class=\"badge\"><img src=\"" + (H.logo||"") + "\" alt=\"\"><span>" + (H.name||"Home") + "</span></div>";
    });

    function J(id){ try { return JSON.parse(document.getElementById(id).textContent) } catch(e) { return null } }
    var P = J("pr-percentiles") || {percentiles:{}};
    var LOOK = ((P||{}).percentiles||{}).epa_pass_per_play || [];

    // Fallback quartiles for passing EPA (last season)
    var Q25 = -0.452, Q50 = -0.234, Q75 = -0.089;
    function pctFromQuartiles(v){
      var vN = parseFloat(v); if(isNaN(vN)) return 0;
      var minV = Q25 - (Q50 - Q25), maxV = Q75 + (Q75 - Q50);
      if (vN <= minV) return 0;
      if (vN >= maxV) return 100;
      if (vN <= Q25) return ( (vN - minV) / (Q25 - minV) ) * 25;
      if (vN <= Q50) return 25 + ( (vN - Q25) / (Q50 - Q25) ) * 25;
      if (vN <= Q75) return 50 + ( (vN - Q50) / (Q75 - Q50) ) * 25;
      return 75 + ( (vN - Q75) / (maxV - Q75) ) * 25;
    }
    function makeECDF(lookup){
      if(!lookup || !lookup.length) return function(v){ return Math.round(pctFromQuartiles(v)) };
      var L = lookup;
      return function(v){
        var x = parseFloat(v); if(isNaN(x)) return 0;
        var lo=0, hi=L.length-1, ans=0;
        while(lo<=hi){ var mid=(lo+hi)>>1; if(x >= L[mid]){ ans=mid; lo=mid+1; } else hi=mid-1; }
        return ans;
      };
    }
    function ordinal(n){
      n = Math.round(n);
      var k = n % 100, j = n % 10;
      if (k >= 11 && k <= 13) return n + "th";
      if (j === 1) return n + "st";
      if (j === 2) return n + "nd";
      if (j === 3) return n + "rd";
      return n + "th";
    }
    var ecdfPass = makeECDF(LOOK);

    function num(x){ var n=parseFloat(x); return isNaN(n)?0:n }
    function fmt(v){ return (v>=0?"+":"") + v.toFixed(2) }
    function pct(x){ var n=parseFloat((x||"").replace("%","")); return isNaN(n)?0:n }

    var aEPA = num(((PR["Avg EPA per passing play"]||{}).away)),
        hEPA = num(((PR["Avg EPA per passing play"]||{}).home));
    var aP = ecdfPass(aEPA), hP = ecdfPass(hEPA);

    // EPA per passing play
    document.getElementById("pr-a-name").textContent = A.name||"Away";
    document.getElementById("pr-h-name").textContent = H.name||"Home";
    document.getElementById("pr-a-logo").src = A.logo||"";
    document.getElementById("pr-h-logo").src = H.logo||"";
    document.getElementById("pr-a-val").textContent  = fmt(aEPA);
    document.getElementById("pr-h-val").textContent  = fmt(hEPA);
    document.getElementById("pr-a-bar").style.width  = aP + "%";
    document.getElementById("pr-h-bar").style.width  = hP + "%";
    (document.getElementById("pr-a-pct")||{}).textContent = ordinal(aP) + " percentile";
    (document.getElementById("pr-h-pct")||{}).textContent = ordinal(hP) + " percentile";

    // Adjusted completion percentage pie charts
    var aAdjComp = pct(((PR["Adj. completion %"]||{}).away)),
        hAdjComp = pct(((PR["Adj. completion %"]||{}).home));
    
    document.getElementById("pr-pie-a-name").textContent = A.name||"Away";
    document.getElementById("pr-pie-h-name").textContent = H.name||"Home";
    document.getElementById("pr-pie-a-logo").src = A.logo||"";
    document.getElementById("pr-pie-h-logo").src = H.logo||"";
    document.getElementById("pr-pie-a-center").textContent = aAdjComp + "%";
    document.getElementById("pr-pie-h-center").textContent = hAdjComp + "%";
    document.getElementById("pr-pie-a-chart").style.setProperty("--completion-deg", (aAdjComp * 3.6) + "deg");
    document.getElementById("pr-pie-h-chart").style.setProperty("--completion-deg", (hAdjComp * 3.6) + "deg");

    function tile(label, key){
      var aw = ((PR[key]||{}).away) || "—", ho = ((PR[key]||{}).home) || "—";
      return "<div class=\"pr-tile\"><h4>" + label + "</h4>"
           + "<div class=\"pr-row\"><span class=\"pr-tag\"><img src=\"" + (A.logo||"") + "\">" + (A.name||"Away") + "</span><span class=\"pr-big\">" + aw + "</span></div>"
           + "<div class=\"pr-row\"><span class=\"pr-tag\"><img src=\"" + (H.logo||"") + "\">" + (H.name||"Home") + "</span><span class=\"pr-big\">" + ho + "</span></div>"
           + "</div>";
    }

    // Passing report
    document.getElementById("pr-summary").innerHTML =
        tile("Gross passing yards","Gross passing yards")
      + tile("Avg (gross) yds per att.","Avg (gross) yds per att.")
      + tile("Avg (gross) yds per comp.","Avg (gross) yds per comp.")
      + tile("Pass Attempts","Pass Attempts")
      + tile("Pass Completions","Pass Completions")
      + tile("Completion %","Completion %");

    // Pass results
    document.getElementById("pr-results").innerHTML =
        tile("Targeted passes","Targeted passes")
      + tile("Dropped passes","Dropped passes")
      + tile("Batted passes","Batted passes")
      + tile("Hit as thrown","Hit as thrown")
      + tile("Throwaways","Throwaways")
      + tile("Spikes","Spikes")
      + tile("Passes broken up","Passes broken up");

    // Air yards and aDOT
    document.getElementById("pr-airyards").innerHTML =
        tile("Avg depth of target","Avg depth of target")
      + tile("Air yards","Air yards")
      + tile("Avg air yds per comp.","Avg air yds per comp.")
      + tile("Yards after the catch","Yards after the catch")
      + tile("Avg YAC per comp.","Avg YAC per comp.")
      + tile("Yds lost on drops","Yds lost on drops");

    // Deep passing & explosive plays
    document.getElementById("pr-deep").innerHTML =
        tile("Explosive passes (15+)","Explosive passes (15+)")
      + tile("Yards on expl. passes","Yards on expl. passes")
      + tile("Deep attempts (20+)","Deep attempts (20+)")
      + tile("Deep completions","Deep completions")
      + tile("Yards on deep comps","Yards on deep comps");

    // Pass protection
    document.getElementById("pr-protection").innerHTML =
        tile("Total pressures allowed","Total pressures allowed")
      + tile("Sacks allowed","Sacks allowed")
      + tile("Yards lost on sacks","Yards lost on sacks")
      + tile("Hits allowed","Hits allowed")
      + tile("Hurries allowed","Hurries allowed")
      + tile("Unbl. pressures allowed","Unbl. pressures allowed")
      + tile("MTs forced on pass plays","MTs forced on pass plays");
  })();
</script>
</body>
</html>
